<!DOCTYPE html><html><head><title>aggregated_channels.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source selected"><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>aggregated_channels.coffee</h1><div class="filepath">core~/widget/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!channels_utils&#39;</span><span class="p">],</span> <span class="nf">(channels_utils) -&gt;</span>

    <span class="k">class</span> <span class="nx">WidgetAggregatedChannelsMixin</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>This class contains all aggregated-channels
related functionality of the Mozaic widget.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">_getSubscribedChannels: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Gets the data channels to which this widget is subscribed.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>This performs token replacement in channels data with parameters
received at the widget initialization. For example, if widget
has been initialized with id = 123 in its parameters, and there
is a data channel "mention/{{id}}", this will return "mention/123".</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">(</span><span class="nx">@replaceTokensWithParams</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="k">for</span> <span class="nx">channel</span> <span class="k">in</span> <span class="nx">@subscribed_channels</span><span class="p">)</span>

        <span class="nv">_getTranslatedSubscribedChannels: </span><span class="nf">-&gt;</span>
            <span class="nv">new_channels = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">translateChannels</span><span class="p">(</span><span class="nx">@subscribed_channels</span><span class="p">,</span> <span class="nx">@channel_mapping</span><span class="p">)</span>
            <span class="nv">result = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">new_channels</span>
                <span class="nv">replaced_k = </span><span class="nx">@replaceTokensWithParams</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
                <span class="nv">replaced_v = </span><span class="nx">@replaceTokensWithParams</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
                <span class="nx">result</span><span class="p">[</span><span class="nx">replaced_k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">replaced_v</span>
            <span class="nx">result</span>

        <span class="nv">_getAggregatedChannels: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Gets the aggregated data channels to which this widget is subscribed.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>For more info, see the comments for _getSubscribedChannels.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">result = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">aggregate_function</span> <span class="k">of</span> <span class="nx">@aggregated_channels</span>
                <span class="nv">channels = </span><span class="nx">@aggregated_channels</span><span class="p">[</span><span class="nx">aggregate_function</span><span class="p">]</span>
                <span class="nx">result</span><span class="p">[</span><span class="nx">aggregate_function</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">@replaceTokensWithParams</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="k">for</span> <span class="nx">channel</span> <span class="k">in</span> <span class="nx">channels</span><span class="p">)</span>
            <span class="nx">result</span>


        <span class="nv">replaceTokensWithParams: </span><span class="nf">(str) -&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Replaces tokens of the form {{id}} from the string with values from params.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>The params are received from the HTML when the widget is instantiated.
TODO: change this to a more pleasant syntax, maybe ruby-like (:id)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">@params</span>
                <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;{{&#39;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s">&#39;}}&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="nv">str = </span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s">&#39;{{&#39;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s">&#39;}}&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">),</span> <span class="nx">v</span><span class="p">)</span>
            <span class="nx">str</span>

        <span class="nv">setupAggregatedChannels: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Sets up the aggregated channels.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">aggregated_channels = </span><span class="nx">@_getAggregatedChannels</span><span class="p">()</span>
            <span class="k">for</span> <span class="nx">aggregate_function</span> <span class="k">of</span> <span class="nx">aggregated_channels</span>
                <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">aggregate_function</span> <span class="k">of</span> <span class="nx">@</span><span class="p">)</span>
                    <span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s">&quot;Aggregate function </span><span class="si">#{</span><span class="nx">aggregate_function</span><span class="si">}</span><span class="s"> does not exist&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="nv">channels = </span><span class="nx">aggregated_channels</span><span class="p">[</span><span class="nx">aggregate_function</span><span class="p">]</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Wrap callback in order to make sure that the we're always
calling the current method for a given key on the widget,
since members of a class instance can be overridden
dynamically at any point in JavaScript</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@aggregateChannels</span><span class="p">((</span><span class="o">=&gt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">aggregate_function</span><span class="p">](</span><span class="nx">arguments</span><span class="p">...)),</span>
                                   <span class="nx">channels</span><span class="p">)</span>

        <span class="nv">aggregateChannels: </span><span class="nf">(callback, channels) -&gt;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Triggers callback whenever all channels have data</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>This is similar to Promise.all() from the Promise.js framework.
For example, if we wish the "render" method to be called whenever
both "/mentions/123" and "/tags" data have arrived, we would use it
like this:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>aggregateChannels(@render, ['/mentions/123', '/tags'])</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>This call will trigger the 'render' member function whenever there
is data for both the given mention and tags. THIS CREATES THE EVENT
HANDLERS FOR EACH CHANNEL IF THEY DON'T EXIST, OR WRAPS THE EXISTING
ONES OTHERWISE.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>After the first time data is available for all channels, this will
trigger the callback each time there is data on any of the channels.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Since this waits for <em>all</em> channels to get data, the following
situations might happen:
- data for one of the channels never comes, and this
never gets executed
- data for a channel comes multiple times (for example,
the mention might be updated multiple times while waiting
for the tags to arrive). In this case, the callback
gets as parameters the last set of parameters for each
of the channels callbacks</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Check if the aggregator data structure is in place.
If not, initialize it.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">@aggregator</span>
                <span class="vi">@aggregator = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Initialize the aggregator</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">key = </span><span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">channels</span><span class="p">,</span> <span class="nf">(x,y) -&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="s">&#39;+&#39;</span> <span class="o">+</span> <span class="nx">y</span><span class="p">)</span>
            <span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Generate channel callbacks or wrap the existing ones</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_callbacks = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">channel</span> <span class="k">in</span> <span class="nx">channels</span>
                <span class="nv">channel_key = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
                <span class="nx">channel_callbacks</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">widgetMethodForChannel</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">channel_key</span><span class="p">)</span>

            <span class="k">for</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">channel_callback</span> <span class="k">of</span> <span class="nx">channel_callbacks</span>
                <span class="nx">do</span><span class="nf">(channel_callbacks, channel, channel_callback, key) =&gt;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>If the callback already exists, we will wrap it
(similar to what decorators do in python).
Otherwise, we will generate automatically a channel callback
and set its property auto_generated to true
(so that we don't break match-making from datasource)</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">old_fn = </span><span class="nx">@</span><span class="p">[</span><span class="nx">channel_callback</span><span class="p">]</span> <span class="k">if</span> <span class="nx">channel_callback</span> <span class="k">of</span> <span class="nx">@</span>

                    <span class="nv">new_fn = </span><span class="nf">(params...) =&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Run the old, wrapped function, if there is one</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="k">if</span> <span class="nx">old_fn</span>
                            <span class="nx">old_fn</span><span class="p">(</span><span class="nx">params</span><span class="p">...)</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Aggregate the parameters passed to this function together
with other sets of parameters</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">params</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>aggregate<em>without</em>join tells us not to wait to have data from
all the channels. Instead, wait to have data from at least
ONE of the channels.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="k">if</span> <span class="nx">@aggregate_without_join</span>
                            <span class="nv">callback_params = </span><span class="p">[]</span>
                            <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">channels</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Check if we have events from channel c
If we do, we will push the data from those
events. Otherwise, we will push "null".</p>
</td><td class="code"><div class="highlight"><pre>                                <span class="k">if</span> <span class="nx">c</span> <span class="k">of</span> <span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
                                    <span class="nv">elem = </span><span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">c</span><span class="p">]</span>
                                <span class="k">else</span>
                                    <span class="nv">elem = </span><span class="kc">null</span>
                                <span class="nv">callback_params = </span><span class="nx">callback_params</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Signal the actual callback</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nx">callback</span><span class="p">(</span><span class="nx">callback_params</span><span class="p">...)</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>If we have received data from all channels,
just signal the designated callback</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">]).</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">channel_callbacks</span><span class="p">).</span><span class="nx">length</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Construct the list of parameters</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nv">callback_params = </span><span class="p">[]</span>
                            <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">channels</span>
                                <span class="nv">callback_params = </span><span class="nx">callback_params</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">@aggregator</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">c</span><span class="p">])</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Signal the actual callback</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nx">callback</span><span class="p">(</span><span class="nx">callback_params</span><span class="p">...)</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Set the auto_generated flag to prevent breakage of the
match-making algorithm in datasource</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">channel_callback</span> <span class="k">of</span> <span class="nx">@</span><span class="p">)</span>
                        <span class="nv">new_fn.auto_generated = </span><span class="kc">true</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Replace the old existing function or create a new one</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@</span><span class="p">[</span><span class="nx">channel_callback</span><span class="p">]</span> <span class="o">=</span> <span class="nx">new_fn</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:44 GMT+0300 (EEST)  </div></div></body></html>