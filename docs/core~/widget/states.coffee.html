<!DOCTYPE html><html><head><title>states.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source selected"><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>states.coffee</h1><div class="filepath">core~/widget/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[],</span> <span class="p">()</span> <span class="nf">-&gt;</span>

    <span class="k">class</span> <span class="nx">WidgetStatesMixin</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>This class contains all state-changing and loading-related
code of the core widget functionality.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h1>TODO(andrei): document the current state machine</h1>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">setupLoadingChannels: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Setup an aggregate method to listen for events
on loading<em>channels
Initialize a loadingStates list of length (loading</em>channels)
and create an aggregate method for loading channels</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">@loadingStates</span><span class="o">?</span>
                <span class="vi">@loadingStates = </span><span class="p">[]</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>For each loading channel set a state
equal to the specified initial @data_state of the widget</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">for</span> <span class="nx">aggregated_channel</span> <span class="k">of</span> <span class="nx">@loading_channels</span>
                    <span class="nx">@loadingStates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">@data_state</span><span class="p">)</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Setup an aggregate method to handle notifications
on the loading_channels only if this widget has
state management</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">@loadingStates</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="nv">channels = </span><span class="p">(</span><span class="nx">@replaceTokensWithParams</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="k">for</span> <span class="nx">channel</span> <span class="k">in</span> <span class="nx">@loading_channels</span><span class="p">)</span>
                    <span class="nx">@aggregateChannels</span><span class="p">(</span><span class="nx">@aggregateLoadingChannelsEvents</span><span class="p">,</span> <span class="nx">channels</span><span class="p">)</span>


        <span class="nv">aggregateLoadingChannelsEvents: </span><span class="nf">(params...) -&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Trigger a state change of a widget after processing
events on loading channels.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>We support the following states (with the priority
described by their order):
1. empty (collection has no data)
2. loading
3. available</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Toggle a state transition if the loadingStates have
changed.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">previousStates = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@loadingStates</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">params</span>
                <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;no_data&#39;</span>
                    <span class="nx">@loadingStates</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;empty&#39;</span>
                <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;invalidate&#39;</span>
                    <span class="nx">@loadingStates</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;loading&#39;</span>
                <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;sync&#39;</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;destroy&#39;</span><span class="p">]</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Check to see if the data on this specific channel is empty</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">@isChannelDataEmpty</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">@loading_channels</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
                        <span class="nx">@loadingStates</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;empty&#39;</span>
                    <span class="k">else</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Data has arrived on loading channels, the state should
be available</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">@loadingStates</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;available&#39;</span>
            <span class="nx">@transitionState</span><span class="p">(</span><span class="nx">@loadingStates</span><span class="p">,</span> <span class="nx">previousStates</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>

        <span class="nv">transitionState: </span><span class="nf">(currentStates, previousStates, params) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Trigger a state transition only if there was
a state change. Transition to the most important state
of the loadingStates</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>The order of states is important as we trigger the
state based on their order (and return immediately):
1. empty
2. loading
3. available</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>If any of the above states (the most important state)
is present in the currentStates, transition to it</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">state</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;empty&#39;</span><span class="p">,</span> <span class="s">&#39;loading&#39;</span><span class="p">,</span> <span class="s">&#39;available&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nx">state</span> <span class="k">in</span> <span class="nx">currentStates</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>If the state is empty employ a different transition
strategy: all loading channels must be in an empty
state to toggle empty. Do nothing if all channels
are not empty.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;empty&#39;</span>
                        <span class="k">if</span> <span class="nx">@allStatesEmpty</span><span class="p">(</span><span class="nx">currentStates</span><span class="p">)</span>
                            <span class="nv">newState = </span><span class="s">&#39;empty&#39;</span>
                            <span class="k">break</span>
                    <span class="k">else</span>
                        <span class="nv">newState = </span><span class="nx">state</span>
                        <span class="k">break</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Trigger a changeState() if there is a transition from an
old state to a new state</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">previousStates</span><span class="p">,</span> <span class="nx">currentStates</span><span class="p">)</span>
                <span class="nx">@changeState</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">([</span><span class="nx">newState</span><span class="p">,</span> <span class="nx">params</span><span class="p">]))</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Also trigger a changeState() when the new state is 'available',
regardless of the old state. This behavior can be disabled
through the STRICT<em>CHANGE</em>STATE flag</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@STRICT_CHANGE_STATE</span> <span class="o">and</span> <span class="nx">newState</span> <span class="o">is</span> <span class="s">&#39;available&#39;</span>
                <span class="nx">@changeState</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">([</span><span class="nx">newState</span><span class="p">,</span> <span class="nx">params</span><span class="p">]))</span>

        <span class="nv">allStatesEmpty: </span><span class="nf">(states) -&gt;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>The condition to transition in an empty
state is for all states on the loading
channels to be empty. Verify all values
in the states list are empty.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>@param {Array} states: a list of the current states the
widget is in. Ex: ['available', 'empty']
@return {Boolean}: True if all values in the states
list are empty</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">states</span>
                <span class="k">if</span> <span class="nx">s</span> <span class="o">!=</span> <span class="s">&#39;empty&#39;</span>
                    <span class="k">return</span> <span class="kc">false</span>
            <span class="k">return</span> <span class="kc">true</span>

        <span class="nv">isChannelDataEmpty: </span><span class="nf">(event, channel = null) -&gt;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>This is the condition trigger for an empty loading state.
Overwrite this in your widgets to let the state manager
know when to toggle an empty state.
By default it inspects the empty state for a collection
type of event.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">collection</span><span class="o">?</span> <span class="o">and</span> <span class="nx">event</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="nv">changeState: </span><span class="nf">(state, params...) -&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Toggle data state.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Possible states:
1. init - Used for rendering blank states at init
2. loading - Used for notifying the user that a request is in process
3. empty - Empty dataset
4. incompatible - Required data is conflicted with current filters
5. available - Available state, with proper data</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>1 and 4 are to be triggered manually from subclasses, the other are
triggered automatically, based on channel events.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p><em>available</em> states with non-empty data should be ignored, because
<em>get</em>items_ channel listeners handle those situations.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Subclass extending and usage example:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>initialize: ->
@changeState('init')</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>changeState: (state, params...) =></p>

<h1>Always call super in order to have the internal</h1>

<h1>data state up to date and the loading methods</h1>

<h1>covered.</h1>

<p>super(state, params...)
if state == 'available' &amp;&amp; !@isChannelDataEmpty(params)
return
if state == 'init'
@renderLayout(@getStateTemplateVars())</p>

<h1>Other states could also be handled here...</h1>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>@see #isChannelDataEmpty
@see #getStateTemplateVars</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">state</span> <span class="o">!=</span> <span class="nx">@data_state</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Trigger loading start if current state is <code>loading</code>
and previous wasn't</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">state</span> <span class="o">==</span> <span class="s">&#39;loading&#39;</span>
                    <span class="nx">@loadingStart</span><span class="p">()</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Trigger loading end if previous state was <code>loading</code>
and current isn't</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="nx">@data_state</span> <span class="o">==</span> <span class="s">&#39;loading&#39;</span>
                    <span class="nx">@loadingEnd</span><span class="p">()</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Update data state if different</p>
</td><td class="code"><div class="highlight"><pre>                <span class="vi">@data_state = </span><span class="nx">state</span>

        <span class="nv">getStateTemplateVars: </span><span class="nf">(params...) -&gt;</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Returns the template vars that the current
state should be rendered with.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>Should be extended in subclasses to return different
data structures depending on the state, otherwise
it just returns an object with the current state</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="p">{</span><span class="nv">state: </span><span class="nx">@data_state</span><span class="p">}</span>

        <span class="nv">loadingStart: </span><span class="nf">(loadingIndicatorEl) -&gt;</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Callback triggered when widget is in a loading
state.
Extend this is subclasses at will.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">loadingEnd: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>Callback triggered when widget leaves the loading
state.
Extend this is subclasses at will.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:46 GMT+0300 (EEST)  </div></div></body></html>