<!DOCTYPE html><html><head><title>urls.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source selected"><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>urls.coffee</h1><div class="filepath">core~/utils/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[],</span> <span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">urls =</span>
        <span class="nv">has_get_params: </span><span class="nf">(url) -&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Returns true if and only if url has GET params.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>For example:
stream/123/?k1=v1 has GET params
stream/123?/k1=v1 doesn't</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">last_slice = </span><span class="nx">url</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">last_slice</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="nv">current_url: </span><span class="nf">(without_fragment = true) -&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Gets the current URL without fragment (by default).</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">without_fragment</span>
                <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">URL</span>

            <span class="nv">first_hash = </span><span class="nb">document</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">first_hash</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">first_hash</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">URL</span>

        <span class="nv">render_url: </span><span class="nf">(url, params, exclude = [], skip_get_append = false) -&gt;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Renders an URL given a template and a set of params.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>url: url template
params: params used for GET params and to fill url placeholders
exclude: ignore some parameters</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Most parameters from params will be appended as GET parameters
(it will check if there are already other parameters), and
some of them will be used to fill in for placeholders.
If a parameter has been used for a placeholder, it won't be
appended as a GET parameter anymore (its information has
already been included in the URL).</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Example:
render_url('streams/{{id}}/facebook?k1=v1',
{gender: 'male', id: 123, sentiment: 'positive'},
['sentiment'])
will return
'streams/123/?k1=v1&amp;gender=male'</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">final_url = </span><span class="nx">url</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Do placeholder replacement and determine the remaining GET params</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">get_params = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">param</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">params</span>
                <span class="nv">tokens = </span><span class="p">[</span><span class="s">&quot;{{</span><span class="si">#{</span><span class="nx">param</span><span class="si">}</span><span class="s">}}&quot;</span><span class="p">,</span> <span class="s">&quot;:</span><span class="si">#{</span><span class="nx">param</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="nx">token</span> <span class="k">in</span> <span class="nx">tokens</span>
                    <span class="k">if</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">delete</span> <span class="nx">get_params</span><span class="p">[</span><span class="nx">param</span><span class="p">]</span>
                        <span class="nv">final_url = </span><span class="nx">final_url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
                        <span class="k">break</span>
                    <span class="k">else</span>
                        <span class="nx">get_params</span><span class="p">[</span><span class="nx">param</span><span class="p">]</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Exclude parameters</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">excluded_param</span> <span class="k">in</span> <span class="nx">exclude</span>
                <span class="k">if</span> <span class="nx">excluded_param</span> <span class="k">of</span> <span class="nx">get_params</span>
                    <span class="k">delete</span> <span class="nx">get_params</span><span class="p">[</span><span class="nx">excluded_param</span><span class="p">]</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>If there are no params to add, return the URL now</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">get_params</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">skip_get_append</span>
                <span class="k">return</span> <span class="nx">final_url</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Add get params using Uri lib</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">final_url = </span><span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nx">final_url</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">param</span><span class="p">,</span> <span class="nx">encodedValue</span> <span class="k">of</span> <span class="nx">get_params</span>
                <span class="nx">final_url</span><span class="p">.</span><span class="nx">addQueryParam</span><span class="p">(</span><span class="nx">param</span><span class="p">,</span> <span class="nx">encodedValue</span><span class="p">)</span>
            <span class="nx">final_url</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

        <span class="nv">model_url: </span><span class="nf">(collection_url, id) -&gt;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Returns the URL for a given model, given the
URL of its collection and the id of the model.
Anything coming after ? (including ?). Ex: ?keyword_id= 25</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">get_params_slice = </span><span class="s">&#39;&#39;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Strip the hashbang first</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">first_hash = </span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">first_hash</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="nv">collection_url = </span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">first_hash</span><span class="p">)</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Strip the GET params</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">last_slash = </span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">last_slash</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>GET params ?keyword_id = 1</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">get_params_slice = </span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">last_slash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Find out the position of the ? in the collection_url</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">get_start = </span><span class="nx">get_params_slice</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">get_start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="nv">get_pos = </span><span class="nx">last_slash</span> <span class="o">+</span> <span class="nx">get_start</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="nv">collection_url = </span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">get_pos</span><span class="p">)</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Add a trailing slash if there isn't one already</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">collection_url</span><span class="p">[</span><span class="nx">collection_url</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;/&#39;</span>
                <span class="nv">collection_url = </span><span class="nx">collection_url</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Append the model id and be done with it</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">collection_url</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">get_params_slice</span>

        <span class="nv">add_params_to_url: </span><span class="nf">(url, array) -&gt;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Add a GET param to URL fragment.
E.g. add<em>params</em>to_url('index.html#search/39315/stream',
[{cat: 'tom'}, {retard: 'ceva'}])
-> 'index.html#search/39315/stream?cat=tom&amp;retard=ceva'</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="k">unless</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span>

            <span class="nv">obj = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">split_url_to_fragment</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
            <span class="nv">uri = </span><span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">fragment</span><span class="p">)</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nf">(param) -&gt;</span>
                <span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>We are using jsUri#replaceQueryParams instead of jsUri#addQueryParam
because replace will not add it again if it already exists.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">uri</span><span class="p">.</span><span class="nx">replaceQueryParam</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">param</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="nx">obj</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Get al fragment GET params from URL.
E.g. get_params('index.html#search/39315/stream?cat=tom&amp;retard=ceva', 'cat', true)
-> [1, 2, 3]
for all = false, return the first one, 1</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">get_fragment_url_params: </span><span class="nf">(url, param, all = false) -&gt;</span>
            <span class="nv">uri = </span><span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nx">Utils</span><span class="p">.</span><span class="nx">split_url_to_fragment</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">fragment</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">all</span>
                <span class="nx">uri</span><span class="p">.</span><span class="nx">getQueryParamValues</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nx">uri</span><span class="p">.</span><span class="nx">getQueryParamValue</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Split this in order to append the query url params to
the fragment if any, not to the path. Like so
index.html#fragment?query<em>appended</em>after_fragment</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">split_url_to_fragment: </span><span class="nf">(url) -&gt;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="nv">url =</span>
                    <span class="nv">fragment: </span><span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="nv">path: </span><span class="nx">url</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nv">url =</span>
                    <span class="nv">fragment: </span><span class="nx">url</span>
                    <span class="nv">path: </span><span class="s">&#39;&#39;</span>

        <span class="nv">get_domain: </span><span class="nf">(url, strip_www=true) -&gt;</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Returns only the domain of a given string.
If strip_www is true it removes www. too</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>In case the url is wrong uri.host() will return the original string</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">uri = </span><span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>

            <span class="nv">final_url = </span><span class="nx">uri</span><span class="p">.</span><span class="nx">host</span><span class="p">()</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Only trim www. from the begining of the url</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">strip_www</span>
                <span class="nv">final_url = </span><span class="nx">final_url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\www./</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="nx">final_url</span>

        <span class="nv">get_url_and_params_from: </span><span class="nf">(hash)-&gt;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Input: #search/1000002491/stream?language=english&amp;country=united states
Returns:
url: /search/1000002491/stream
params: {language: 'english', country: 'united states'}</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Change the hash into a relative path ..</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">relativeUrl = </span><span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">_</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">ltrim</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="s">&#39;#&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>.. And pass it to the Uri constructor
We're doing this so that the Uri object would compute the path and query params correctly</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">uri = </span><span class="k">new</span> <span class="nx">Uri</span><span class="p">(</span><span class="nx">relativeUrl</span><span class="p">)</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>take the path from url</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">url = </span><span class="nx">uri</span><span class="p">.</span><span class="nx">path</span><span class="p">()</span>

            <span class="nv">params = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Uri returns query().params in this form: [['language': 'english'], ['country': 'united states']]
And we want to return them as object: {language: 'english', country: 'united states'}</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">params</span>
                <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>

            <span class="k">return</span> <span class="p">[</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">]</span>

        <span class="nv">stripHTMLOutsideTags: </span><span class="nf">(content) -&gt;</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Given a text like <a href='#'>http://url.com</a>, remove the
anchors around the URL, returning only http://url.com.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;div&gt;</span><span class="si">#{</span><span class="nx">content</span><span class="si">}</span><span class="s">&lt;/div&gt;&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span>


    <span class="k">return</span> <span class="nx">urls</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:44 GMT+0300 (EEST)  </div></div></body></html>