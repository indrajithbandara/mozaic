<!DOCTYPE html><html><head><title>widget_editor.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source selected"><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>widget_editor.coffee</h1><div class="filepath">core~/base_widgets/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[],</span> <span class="p">()</span> <span class="nf">-&gt;</span>

    <span class="k">class</span> <span class="nx">WidgetEditor</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Form</span><span class="p">.</span><span class="nx">editors</span><span class="p">.</span><span class="nx">Base</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>The Widget Editor is a BBF Editor-compatible Widget wrapper,
that has a Mozaic widget attached that it controls.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>The idea is to have most of the logic in the attached widget
and avoid extending this widget altogether.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">template: </span><span class="s">&#39;&lt;div class=&quot;mozaic-widget&quot; data-widget=&quot;{{widget_name}}&quot; data-params=&quot;{{widget_params}}&quot;&gt;&lt;/div&gt;&#39;</span>

        <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
            <span class="k">super</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>A widget name in the model schema is required for this
to work</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@widget_name = </span><span class="nx">@schema</span><span class="p">.</span><span class="nx">widget_name</span>
            <span class="k">unless</span> <span class="nx">@widget_name</span><span class="o">?</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;Editor has no widget name assigned&#39;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Support a default value for when the editor has not yet
initialized</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@default_value = </span><span class="nx">@schema</span><span class="p">.</span><span class="nx">default_value</span>
            <span class="nx">@default_value</span> <span class="o">?=</span> <span class="kc">null</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Default widget params can be specified in the model schema
as well, as a starting point</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@widget_params = </span><span class="nx">@schema</span><span class="p">.</span><span class="nx">widget_params</span> <span class="o">or</span> <span class="p">{}</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Additional widget params are taken from the form template,
which are actually set to the field's div</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">@widget_params</span><span class="p">,</span> <span class="nx">@_getParamsFromEditorField</span><span class="p">())</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>The value must always be passed to the editor widget</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@widget_params.value = </span><span class="nx">@value</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Pass on options for select-like editors</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@schema</span><span class="p">.</span><span class="nx">options</span><span class="o">?</span>
                <span class="nv">options = </span><span class="nx">@schema</span><span class="p">.</span><span class="nx">options</span>
                <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
                    <span class="nx">options</span> <span class="nf">(result) =&gt;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>XXX does not support async populating</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="vi">@widget_params.options = </span><span class="nx">result</span>
                <span class="k">else</span>
                    <span class="vi">@widget_params.options = </span><span class="nx">options</span>

        <span class="nv">_getParamsFromEditorField: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Get data-params from editor's parent <em>field</em>.
The field nor the editor templates are not yet bound to
the form DOM so a relative jQuery path cannot be used.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">editorField = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;[data-field=&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">editorField</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;params&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="p">{}</span>

        <span class="nv">render: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Before rendering, start listening to the "/new_widget"
pubsub channel, in order to grab the new-born widget
as soon as it takes life. @see #newWidget</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Then, render a widget div as the editor output, and let
the loader handle its initiation and manage its entire
existance and garbage collection from that point on.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
            <span class="nx">@pipe</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s">&#39;/new_widget&#39;</span><span class="p">,</span> <span class="nx">@newWidget</span><span class="p">)</span>
            <span class="vi">@subscribed_to_widget_rendering = </span><span class="kc">false</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Compile and render widget container template</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">template = </span><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">@template</span><span class="p">)</span>
            <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span> <span class="nx">template</span><span class="p">(</span>
                <span class="nv">widget_name: </span><span class="nx">@widget_name</span>
                <span class="nv">widget_params: </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">@widget_params</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="k">this</span>

        <span class="nv">newWidget: </span><span class="nf">(message) =&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Whenever a new widget is announced, we check to see
it is the one created by this editor, by matching its
name against the editor's assigned widget<em>name and then
by matching its id against _mozaic-widget</em> child nodes.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>As soon as <em>the one</em> is intercepted we store it locally
and remove this handler altogether.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="k">if</span> <span class="nx">message</span><span class="p">.</span><span class="nx">name</span> <span class="o">isnt</span> <span class="nx">@widget_name</span>
            <span class="nv">widget_id = </span><span class="nx">message</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">widget_id</span>
            <span class="k">if</span> <span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;[data-guid=</span><span class="si">#{</span><span class="nx">widget_id</span><span class="si">}</span><span class="s">]&quot;</span><span class="p">).</span><span class="nx">length</span>
                <span class="vi">@widget = </span><span class="nx">message</span><span class="p">.</span><span class="nx">widget</span>
                <span class="nx">@pipe</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="s">&#39;/new_widget&#39;</span><span class="p">,</span> <span class="nx">@newWidget</span><span class="p">)</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Create a back-reference to editor in widget</p>
</td><td class="code"><div class="highlight"><pre>                <span class="vi">@widget.editor = </span><span class="k">this</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Call initializeWithForm method on editor, if one is
implemented. Delay this call until renderLayout() has
been called at least once, because most widget editors
do setValue() in initializeWithForm, which implicitly
requires the DOM to be ready.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@widget</span><span class="p">.</span><span class="nx">initializeWithForm</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nx">@widget</span><span class="p">.</span><span class="nx">DELAYED_INITIALIZE_WITH_FORM</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@widget</span><span class="p">.</span><span class="nx">DELAYED_INITIALIZE_WITH_FORM</span>
                        <span class="nx">@pipe</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s">&#39;/new_widget_rendered&#39;</span><span class="p">,</span> <span class="nx">@editorWidgetHasRendered</span><span class="p">)</span>
                    <span class="k">else</span>
                        <span class="nx">@widget</span><span class="p">.</span><span class="nx">initializeWithForm</span><span class="p">(</span><span class="nx">@form</span><span class="p">)</span>

        <span class="nv">editorWidgetHasRendered: </span><span class="nf">(widget_id, widget_name) =&gt;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Callback for running initialize-like method of widget editor,
that is called whenever the proxy widget and the editor itself
are setup and cross-referenced correctly.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Since most editor widgets also use the DOM in initializeWithForm,
we make sure that the DOM is right there by waiting for at least
one renderLayout() to occur.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@widget</span><span class="p">.</span><span class="nx">initializeWithForm</span><span class="p">(</span><span class="nx">@form</span><span class="p">)</span>
            <span class="nx">@pipe</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="s">&#39;/new_widget_rendered&#39;</span><span class="p">,</span> <span class="nx">@editorWidgetHasRendered</span><span class="p">)</span>

        <span class="nv">getValue: </span><span class="p">()</span> <span class="nf">-&gt;</span>
            <span class="k">return</span> <span class="k">if</span> <span class="nx">@widget</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@widget</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@default_value</span>

        <span class="nv">setValue: </span><span class="nf">(value) -&gt;</span>
            <span class="vi">@value = </span><span class="nx">value</span>
            <span class="nx">@widget</span><span class="o">?</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">@value</span><span class="p">)</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Keep form model up to date with editor values</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@schema</span><span class="p">.</span><span class="nx">sync_form_model</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@formHasValue</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
                <span class="nx">@form</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">@key</span><span class="p">,</span> <span class="nx">@getValue</span><span class="p">(),</span> <span class="nv">silent: </span><span class="kc">true</span><span class="p">)</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>After we update the editor's corresponding model value, go
through all the other from editors (but this one), and update
their value with the one in the model. This is useful because
changing a model attribute might change other ones as well,
thus having more logic inside the models.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">field</span> <span class="k">of</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">fields</span>
                    <span class="k">continue</span> <span class="k">if</span> <span class="nx">key</span> <span class="o">is</span> <span class="nx">@key</span>
                    <span class="nv">editor = </span><span class="nx">field</span><span class="p">.</span><span class="nx">editor</span>
                    <span class="nv">modelValue = </span><span class="nx">@form</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Since the Underscore check is strict we need to make sure
null and undefined values are loosely compared, so the
modalValue need to be null if missing. This avoids a lot
of pointless assignments and hook triggerings</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">modelValue = </span><span class="kc">null</span> <span class="k">unless</span> <span class="nx">modelValue</span><span class="o">?</span>
                    <span class="k">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">modelValue</span><span class="p">,</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">())</span>
                        <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">modelValue</span><span class="p">)</span>

            <span class="nx">@notifyModelChanged</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>

        <span class="nv">notifyModelChanged: </span><span class="nf">(value) -&gt;</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Check for form hooks that listen to model changes and trigger
them if defined</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@form</span><span class="p">.</span><span class="nx">formWidget</span><span class="o">?</span><span class="p">.</span><span class="nx">modelChanged</span><span class="p">)</span>
                <span class="nx">@form</span><span class="p">.</span><span class="nx">formWidget</span><span class="p">.</span><span class="nx">modelChanged</span><span class="p">(</span><span class="nx">@key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>

        <span class="nv">formHasValue: </span><span class="nf">(value) -&gt;</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Check if the editor value is equal with the current one inside
the form.
Match null and undefined as equal though, since they both
represent missing values</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">formValue = </span><span class="nx">@form</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@key</span><span class="p">)</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Strict comparison (===)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">formValue</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>If they're not strictly equal and one of the is defined, then
they're not equal</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">value</span><span class="o">?</span> <span class="o">or</span> <span class="nx">formValue</span><span class="o">?</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>At this point they're both null/undefined</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="kc">true</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:34 GMT+0300 (EEST)  </div></div></body></html>