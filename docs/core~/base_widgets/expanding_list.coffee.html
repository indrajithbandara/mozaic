<!DOCTYPE html><html><head><title>expanding_list.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source selected"><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>expanding_list.coffee</h1><div class="filepath">core~/base_widgets/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!widget&#39;</span><span class="p">],</span> <span class="nf">(Widget) -&gt;</span>

    <span class="k">class</span> <span class="nx">ExpandingList</span> <span class="k">extends</span> <span class="nx">Widget</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Wrapper for a regular List that loads an extended item to the right
of it, while compacting the list to the left.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>It is in charge of listening to /filters changes and render a
corresponding widget next to the list. Besides rendering the widget,
it should also toggle a .compact class on the List widget, which
will render it compact (through sole CSS magic---win!)</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>The filter is also set from inside it, in order to have as much
self-contained logic as possible. It will listen to click events
targeted on the list items directly, thus becoming independent from
the list or its items (and viceversa)</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Params:
- filter<em>key: the name of the filter to be set with the id of
the selected item's model.
- list</em>widget: the widget name of the list (ideally subclass of
the List widget or a List directly)
- list<em>params: the params to be sent to the list widget
- item</em>widget: the widget name of the extended item
- item<em>params: the params to be sent to the extended item widget
- scroll</em>channel: enable list scrolling to load more items when
user scroll to the bottom
- header<em>widget: the widget name of the list header (optional)
- header</em>params: the params to be sent to the header widget</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">subscribed_channels: </span><span class="p">[</span><span class="s">&#39;/items&#39;</span><span class="p">,</span> <span class="s">&#39;/filters&#39;</span><span class="p">]</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Enable state management in order to detect when the list has hit
bottom (when an <code>empty</code> state was triggered)</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">initial_state: </span><span class="s">&#39;loading&#39;</span>
        <span class="nv">loading_channels: </span><span class="p">[</span><span class="s">&#39;/items&#39;</span><span class="p">]</span>

        <span class="nv">template_name: </span><span class="s">&#39;templates/expanding-list.hjs&#39;</span>

        <span class="nv">elements:</span>
            <span class="nv">list: </span><span class="s">&#39;.list&#39;</span>
            <span class="nv">listViewport: </span><span class="s">&#39;.list-viewport&#39;</span>
            <span class="nv">itemContainer: </span><span class="s">&#39;.item-container&#39;</span>

        <span class="nv">events:</span>
            <span class="s">&#39;click .list .extend&#39;</span><span class="o">:</span> <span class="s">&#39;onExpand&#39;</span>
            <span class="s">&#39;click .retract&#39;</span><span class="o">:</span> <span class="s">&#39;onRetract&#39;</span>

        <span class="nv">params_defaults:</span>
            <span class="nv">filter_key: </span><span class="nf">(key) -&gt;</span> <span class="nx">key</span> <span class="o">or</span> <span class="s">&#39;id&#39;</span>
            <span class="nv">list_widget: </span><span class="nf">(widget) -&gt;</span> <span class="nx">widget</span> <span class="o">or</span> <span class="s">&#39;list&#39;</span>
            <span class="nv">list_params: </span><span class="nf">(params) -&gt;</span> <span class="nx">params</span> <span class="o">or</span> <span class="p">{}</span>
            <span class="nv">item_widget: </span><span class="nf">(widget) -&gt;</span> <span class="nx">widget</span> <span class="o">or</span> <span class="s">&#39;widget&#39;</span>
            <span class="nv">item_params: </span><span class="nf">(params) -&gt;</span> <span class="nx">params</span> <span class="o">or</span> <span class="p">{}</span>
            <span class="nv">header_widget: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">header_params: </span><span class="nf">(params) -&gt;</span> <span class="nx">params</span> <span class="o">or</span> <span class="p">{}</span>
            <span class="nv">scroll_channel: </span><span class="s">&#39;data-params&#39;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Gets set to <code>true</code> when scrolling is enabled and all items have
already been loaded</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">reached_bottom: </span><span class="kc">false</span>

        <span class="nv">initialize: </span><span class="nf">-&gt;</span>
            <span class="nx">@renderLayout</span><span class="p">(</span>
                <span class="nv">list_widget: </span><span class="nx">@list_widget</span>
                <span class="nv">list_params: </span><span class="nx">@extendParams</span><span class="p">(</span><span class="nx">@list_params</span><span class="p">)</span>
                <span class="nv">header_widget: </span><span class="nx">@header_widget</span>
                <span class="nv">header_params: </span><span class="nx">@extendParams</span><span class="p">(</span><span class="nx">@header_params</span><span class="p">)</span>
            <span class="p">,</span> <span class="kc">false</span><span class="p">)</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Listen to scroll events on the list viewport in the presence of
a scrollable list</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@listViewport</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">@onScroll</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@scroll_channel</span>

        <span class="nv">changeState: </span><span class="nf">(state) -&gt;</span>
            <span class="k">super</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Disable scroll if loaded all items or there weren't any items
to begin with</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@reached_bottom = </span><span class="kc">true</span> <span class="k">if</span> <span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;empty&#39;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>(Re)enable scroll as soon as there seems to be data available,
either initially when a channel isn't empty or after a channel
reset (like changing a filter)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@reached_bottom = </span><span class="kc">false</span> <span class="k">if</span> <span class="nx">state</span> <span class="o">is</span> <span class="s">&#39;available&#39;</span>

        <span class="nv">get_filters: </span><span class="nf">(params) =&gt;</span>
            <span class="nv">itemId = </span><span class="nx">params</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@filter_key</span><span class="p">)</span>
            <span class="k">unless</span> <span class="nx">itemId</span> <span class="o">is</span> <span class="nx">@currentItemId</span>
                <span class="k">if</span> <span class="nx">itemId</span> <span class="k">then</span> <span class="nx">@expand</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@contract</span><span class="p">()</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>XXX this doesn't work on page load because the list will not be
rendered at this point, we need to find a way to send the active
element to the list directly (which means we should wait and
render the list only after we receive filters data)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@updateActiveElement</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Make sure scroll is maintained between list states</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">@currentItemId</span> <span class="o">and</span> <span class="nx">itemId</span>
                <span class="nx">@focusOnItem</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">@currentItemId</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">itemId</span>
                <span class="nx">@focusOnItem</span><span class="p">(</span><span class="nx">@currentItemId</span><span class="p">)</span>

            <span class="vi">@currentItemId = </span><span class="nx">itemId</span>

        <span class="nv">expand: </span><span class="nf">(itemId) -&gt;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Mark itself as expanded</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;expanded&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Mark list as compacted</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@list</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;compact&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Inject expanded item</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">Utils</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="nx">@item_widget</span><span class="p">,</span>
                <span class="nv">container: </span><span class="nx">@itemContainer</span>
                <span class="nv">params: </span><span class="nx">@getItemParams</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span>
                <span class="nv">placement: </span><span class="s">&#39;replace&#39;</span>
            <span class="p">)</span>

        <span class="nv">contract: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Mark itself as normal</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;expanded&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Mark list as normal</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@list</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;compact&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Clear any expanded item injected</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@itemContainer</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>

        <span class="nv">updateActiveElement: </span><span class="nf">(itemId) -&gt;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Set .active class on selected item (if any)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@list</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;&gt; li&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span>
                              <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s">&quot;.item-</span><span class="si">#{</span><span class="nx">itemId</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
                              <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span>

        <span class="nv">focusOnItem: </span><span class="nf">(itemId) -&gt;</span>
            <span class="nv">item = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.item-</span><span class="si">#{</span><span class="nx">itemId</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">length</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Get item offset relative to the list</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">itemOffset = </span><span class="nx">item</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span>
                <span class="nx">@listViewport</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="nx">itemOffset</span><span class="p">)</span>

        <span class="nv">getItemParams: </span><span class="nf">(itemId) -&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Add id to item params and then all channels</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">@extendParams</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nv">id: </span><span class="nx">itemId</span><span class="p">},</span> <span class="nx">@item_params</span><span class="p">))</span>

        <span class="nv">extendParams: </span><span class="nf">(params) -&gt;</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Extend list and list item params with the entire channel list
received. This way we're cleaning up the passing of channels
through all this list-related widgets: the union of all the
channels needed for the expanded list, the list iteself and its
items should be put together and sent to all of them from one
place only. The overhead of passing possibly irrelevant
channels is insignificant.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nv">channels: </span><span class="nx">@params</span><span class="p">.</span><span class="nx">channels</span><span class="p">},</span> <span class="nx">params</span><span class="p">)</span>

        <span class="nv">onExpand: </span><span class="nf">(e) =&gt;</span>
            <span class="nv">item = </span><span class="nx">@getItemFromEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Deny any events from child links or buttons</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">isnt</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span>
                <span class="nv">buttonTags = </span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;button&#39;</span><span class="p">]</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>If the clicked target itself is a button</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">return</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeType</span> <span class="k">in</span> <span class="nx">buttonTags</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>If the clicked target is inside a button and that buttons is
a child of the item</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">for</span> <span class="nx">tag</span> <span class="k">in</span> <span class="nx">buttonTags</span>
                    <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="nx">tag</span><span class="p">).</span><span class="nx">length</span>
                        <span class="k">return</span> <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="nx">tag</span><span class="p">)).</span><span class="nx">length</span>

            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Make sure user is not trying to select something, which case we
should disable the expanding</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="k">if</span> <span class="nx">getSelection</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

            <span class="nx">@modifyChannel</span><span class="p">(</span><span class="s">&#39;/filters&#39;</span><span class="p">,</span> <span class="nx">@getFilterChangesForExpand</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span>

        <span class="nv">getFilterChangesForExpand: </span><span class="nf">(item) -&gt;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Filter changes for the case of item expansion.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>By default, it only includes the id of the item, but feel
free to override this in your inherited class in order to
provide custom URL parameters.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">filterChange = </span><span class="p">{}</span>
            <span class="nx">filterChange</span><span class="p">[</span><span class="nx">@filter_key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">filterChange</span>

        <span class="nv">onRetract: </span><span class="nf">(e) =&gt;</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

            <span class="nx">@modifyChannel</span><span class="p">(</span><span class="s">&#39;/filters&#39;</span><span class="p">,</span>
                           <span class="nx">@getFilterChangesForRetract</span><span class="p">(),</span>
                           <span class="p">{</span><span class="nv">update_mode: </span><span class="s">&#39;exclude&#39;</span><span class="p">})</span>

        <span class="nv">getFilterChangesForRetract: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Filter changes for the case of item retraction.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>By default, we only clean up the item id, but please feel free
to do some more clean-up in your inherited class in order
to match the keys you're publishing to filters in
getFilterChangesForExpand.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">filterChange = </span><span class="p">{}</span>
            <span class="nx">filterChange</span><span class="p">[</span><span class="nx">@filter_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span>
            <span class="k">return</span> <span class="nx">filterChange</span>

        <span class="nv">onScroll: </span><span class="nf">(e) =&gt;</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>In the case of scrollable lists (a list that needs to "load
more" once the users scroll to its bottom side), check when
the users comes very close to bottom part of the list and
scroll the list channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">top = </span><span class="nx">@listViewport</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span>
            <span class="nv">dif = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@listViewport</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span> <span class="o">-</span> <span class="nx">top</span>

            <span class="nx">@scrollList</span><span class="p">()</span> <span class="k">if</span> <span class="nx">dif</span> <span class="o">&lt;</span> <span class="mi">5</span>

        <span class="nv">scrollList: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Scroll list channel until it reaches bottom (no new items were
returned by the last refresh)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@scrollChannel</span><span class="p">(</span><span class="s">&#39;/items&#39;</span><span class="p">)</span> <span class="k">unless</span> <span class="nx">@reached_bottom</span>

        <span class="nv">getItemFromEvent: </span><span class="nf">(e) -&gt;</span>
            <span class="nv">target = </span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">target</span> <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s">&#39;list-item&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">target</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s">&#39;.list-item&#39;</span><span class="p">)</span>

        <span class="nv">destroy: </span><span class="o">=&gt;</span>
            <span class="k">super</span><span class="p">()</span>
            <span class="nx">@listViewport</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">@onScroll</span><span class="p">)</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:31 GMT+0300 (EEST)  </div></div></body></html>