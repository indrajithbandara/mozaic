<!DOCTYPE html><html><head><title>list.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source selected"><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>list.coffee</h1><div class="filepath">core~/base_widgets/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!scrollable_widget&#39;</span><span class="p">],</span> <span class="nf">(ScrollableWidget) -&gt;</span>

    <span class="k">class</span> <span class="nx">List</span> <span class="k">extends</span> <span class="nx">ScrollableWidget</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Widget which is able to render a list of items, by injecting
one widget per each item. An item to be displayed will be named
ListItem.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Features:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><ul>
<li>not all widgets for all items must be the same. There is
a mappings parameter which specifies different parameters
and different channels for each type of widget. In order
to find out the correct param, the list takes into
account ListItem['object_class].</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><ul>
<li>it's able to maintain a client-side sorted order for widgets,
depending on one or more criteria. For example, it can sort
by 'created_at' key descending as the primary key, and when
two items are tied, break the tie with the 'name' field.
It supports custom comparators for each field. Out of the box,
it supports ints, floats, strings and dates.</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><ul>
<li>it keeps a CSS class on the first and last item of the
list, even when the list order changes. And the list order
might change because of a change in a field that's a sort key!
This is very useful for design issues.</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><ul>
<li>it manages the lifecycle of the widgets corresponding to
ListItems, by removing them from the DOM when the item
is removed from the channel, or by adding new ones when
an item is added to a channel. It is also able to MOVE
around a widget, but by making a DELETE + INSERT (Mozaic
core doesn't yet support moving widgets around in DOM)</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><ul>
<li>it can filter items from the collection and only display
those we're interested in. For example, say that I'm
fetching the list of all books from the server, and I want
to display only the books by a certain author.</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><ul>
<li>while the list is built around an /items channel in the
default implementation, its interface allows having more than
one channel (using aggregated channels) for building the list
items. All channel events must be funneled into the
@handleChannelEvents method, and items are joined together
under the @getModelsFromChannelData method</li>
</ul>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>IMO lifecycle management of the widgets is the most important
feature of this widget - if I want to display a list, I can
concentrate on writing the widget for the list's item instead of
repeating the same boilerplate code for removing the widget from
DOM when it's removed from the channel, and so on.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">subscribed_channels: </span><span class="p">[</span><span class="s">&#39;/items&#39;</span><span class="p">]</span>
        <span class="nv">loading_channels: </span><span class="p">[</span><span class="s">&#39;/items&#39;</span><span class="p">]</span>

        <span class="nv">template_name : </span><span class="s">&#39;templates/list.hjs&#39;</span>

        <span class="nv">params_defaults:</span>
            <span class="nv">enable_scroll: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">item: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">item_channels: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">item_params: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">item_class: </span><span class="s">&#39;data-params&#39;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Used to specify what fields to dynamically extract
from model. Should look like {key1: new<em>key1, key2: new</em>key2, ..}
where key is the one in model, and new_key is the one will be used
as key.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">item_model_params: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">filter_by: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">sort_by: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">container: </span><span class="s">&#39;data-params&#39;</span>
            <span class="nv">item_element: </span><span class="nf">(value) -&gt;</span> <span class="nx">value</span> <span class="o">or</span> <span class="s">&#39;li&#39;</span>
            <span class="nv">prepend: </span><span class="s">&#39;data-params&#39;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>This mappings params is used to be able
to insert different widgets (with different
models).</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">mappings: </span><span class="s">&#39;data-params&#39;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>A list of comparators for list. You can also push to
this list and define your own comparator in your type
of list.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">_comparators_map:</span>
            <span class="nv">str: </span><span class="s">&#39;strComparator&#39;</span>
            <span class="nv">int: </span><span class="s">&#39;intComparator&#39;</span>
            <span class="nv">float: </span><span class="s">&#39;floatComparator&#39;</span>
            <span class="nv">date: </span><span class="s">&#39;dateComparator&#39;</span>
            <span class="nv">bool: </span><span class="s">&#39;boolComparator&#39;</span>

        <span class="nv">registerComparator: </span><span class="nf">(key, comparator) -&gt;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Adds a comparator to the current list instance.
@param {String} key
@param {string} comparator - name of the method to be used as comparator</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">comparator</span><span class="p">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;params `key` and `comparator` must both be strings&quot;</span>
            <span class="k">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@</span><span class="p">[</span><span class="nx">comparator</span><span class="p">]</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;this.</span><span class="si">#{</span><span class="nx">comparator</span><span class="si">}</span><span class="s"> is not a function&quot;</span>
            <span class="nx">@_comparators_map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">comparator</span>

        <span class="nv">widget_params: </span><span class="p">{}</span>

        <span class="nv">initialize: </span><span class="o">=&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>If the scroll is enabled in the params, then make
the items channel a scrollable one</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@enable_scroll</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Make all loading channels scrollable because widget states
are triggered by loading ones and affect the scrollable ones</p>
</td><td class="code"><div class="highlight"><pre>                <span class="vi">@scrollable_channels = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@loading_channels</span><span class="p">)</span>

            <span class="nx">@extendWidgetParamsFromItem</span><span class="p">()</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Make sure that sort<em>by is actually a dict
with keys as filtering criteria and values as
comparator types ('str' and 'int' supported so far).
So, if I want to filter by folder</em>id first, which is an
int folder, and by name afterwards, I would give it
{folder_id: 'int', name: 'str'}</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@sort_by</span><span class="o">?</span>
                <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">@sort_by</span><span class="p">)</span>
                    <span class="nv">new_sort_by = </span><span class="p">{}</span>
                    <span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">@sort_by</span>
                        <span class="nx">new_sort_by</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;str&#39;</span>
                    <span class="vi">@sort_by = </span><span class="nx">new_sort_by</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">@sort_by</span><span class="p">))</span>
                    <span class="nv">field = </span><span class="nx">@sort_by</span>
                    <span class="vi">@sort_by = </span><span class="p">{}</span>
                    <span class="nx">@sort_by</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;str&#39;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Initialize the array of IDs</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@ids = </span><span class="p">[]</span>

            <span class="k">super</span><span class="p">()</span>

        <span class="nv">changeState: </span><span class="nf">(state, params...) -&gt;</span>
            <span class="k">super</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span>
            <span class="k">if</span> <span class="nx">state</span> <span class="o">==</span> <span class="s">&#39;empty&#39;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>TODO: Add <code>end</code> state to widget base
Support multiple loading channels for building the list's
item feed</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="o">not</span> <span class="nx">@getModelsFromChannelData</span><span class="p">(</span><span class="nx">params</span><span class="p">...).</span><span class="nx">length</span>
                    <span class="nx">@renderLayout</span> <span class="p">{</span><span class="nv">state: </span><span class="nx">state</span><span class="p">}</span>
                <span class="k">else</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Maybe add something to the bottom of all items instead</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">Utils</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">Constants</span><span class="p">.</span><span class="nx">LOADING_END_NOTIFICATION</span><span class="p">,</span> <span class="s">&#39;notice&#39;</span><span class="p">)</span>

        <span class="nv">loadingStart: </span><span class="p">()</span> <span class="nf">-&gt;</span>
            <span class="nx">Utils</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">Constants</span><span class="p">.</span><span class="nx">LOADING_NOTIFICATION</span><span class="p">,</span> <span class="s">&#39;loading&#39;</span><span class="p">)</span>

        <span class="nv">loadingEnd: </span><span class="p">()</span> <span class="nf">-&gt;</span>
            <span class="nx">Utils</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s">&#39;loading&#39;</span><span class="p">)</span>

        <span class="nv">compare: </span><span class="nf">(a, b) =&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Goes through each @sort_by field until it finds difference
between models. By default the order is ascending.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>One can give the following sort<em>by syntax:
sort</em>by:
'pub_date desc': 'date'
By default, sorting is 'asc'.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>The compare supports multiple fields of comparation, and
in case of a tie, it goes comparint to the next field.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">comparator</span> <span class="k">of</span> <span class="nx">@sort_by</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Set ascending as default order</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">ascending = </span><span class="kc">true</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Search if order (asc/desc) is specified. Make sure field is
string.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">tokens = </span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="nx">field</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span>
                    <span class="nv">field = </span><span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">switch</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">when</span> <span class="s">&#39;asc&#39;</span> <span class="k">then</span> <span class="nv">ascending = </span><span class="kc">true</span>
                        <span class="k">when</span> <span class="s">&#39;desc&#39;</span> <span class="k">then</span> <span class="nv">ascending = </span><span class="kc">false</span>
                        <span class="k">else</span> <span class="nv">ascending = </span><span class="kc">true</span>

                <span class="nv">comparisonResult = </span><span class="nx">@compareByField</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">comparator</span><span class="p">)</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Return only if difference found, else continue
ordering by the next sort_by option.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">unless</span> <span class="nx">comparisonResult</span> <span class="o">is</span> <span class="mi">0</span>
                    <span class="k">return</span> <span class="k">if</span> <span class="nx">ascending</span> <span class="k">then</span> <span class="nx">comparisonResult</span> <span class="k">else</span> <span class="o">-</span><span class="nx">comparisonResult</span>

            <span class="k">return</span> <span class="mi">0</span>

        <span class="nv">compareByField: </span><span class="nf">(a, b, field, comparator) -&gt;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Compares two models a and b with the criteria given by
field. Follows the normal comparator convention and returns
the equivalent of a - b, that is:
-1, if a &lt; b
0, if a == b
1, if a > b</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">va = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">getAttributeFromModel</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">field</span><span class="p">)</span>
            <span class="nv">vb = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">getAttributeFromModel</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">field</span><span class="p">)</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Get the comparison function, defined in COMPARATORS_MAP
constant above.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">f = </span><span class="nx">@</span><span class="p">[</span> <span class="nx">@_comparators_map</span><span class="p">[</span><span class="nx">comparator</span><span class="p">]</span> <span class="p">]</span>
            <span class="k">unless</span> <span class="nx">f</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;No comparison function for </span><span class="si">#{</span><span class="nx">comparator</span><span class="si">}</span><span class="s"> comarator type.&quot;</span>
                <span class="k">return</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span><span class="p">,</span> <span class="nx">va</span><span class="p">,</span> <span class="nx">vb</span>

        <span class="nv">intComparator: </span><span class="nf">(a, b) -&gt;</span>
            <span class="nv">a = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="nv">b = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span>

        <span class="nv">floatComparator: </span><span class="nf">(a, b) -&gt;</span>
            <span class="nv">a = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="nv">b = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span>

        <span class="nv">strComparator: </span><span class="nf">(a, b) -&gt;</span>
            <span class="nv">a = </span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">trim</span> <span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span>
            <span class="nv">b = </span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">trim</span> <span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="nv">boolComparator: </span><span class="nf">(a, b) -&gt;</span>
            <span class="nv">a = </span><span class="nb">Boolean</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
            <span class="nv">b = </span><span class="nb">Boolean</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">b</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">a</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">b</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="nv">dateComparator: </span><span class="nf">(a, b) -&gt;</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>If you are comparing two dates that
momentjs does not support, you should
override this comparator and define
your own format.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">f = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">getUTCTimestampFromDate</span>
            <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-</span> <span class="nx">f</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>

        <span class="nv">matchesFilters: </span><span class="nf">(model) =&gt;</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Checks if the model corresponds to the given filtering criteria.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="kc">true</span> <span class="k">unless</span> <span class="nx">@filter_by</span><span class="o">?</span>
            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">@filter_by</span>
                <span class="k">if</span> <span class="nb">String</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">false</span>
            <span class="k">return</span> <span class="kc">true</span>

        <span class="nv">get_items: </span><span class="nf">(item_params) =&gt;</span>
            <span class="nx">@handleChannelEvents</span><span class="p">(</span><span class="nx">item_params</span><span class="p">)</span>

        <span class="nv">handleChannelEvents: </span><span class="nf">(item_params) -&gt;</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Method for processing channel data and inserting received items
onto the list. It is called w/ the single /items channel from
its channel callback method in the default implementation, but
can be used in subclasses to have additional channels that
construct the list's items. The items from more than one
channel can be aggregated using the @getModelsFromChannelData
method, which receives all arguments that this method received,
which can be a list of channel events</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">model = </span><span class="nx">item_params</span><span class="p">.</span><span class="nx">model</span>
            <span class="nv">models = </span><span class="nx">@getModelsFromChannelData</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Detecting whether we need to re-render the entire list is tricky,
we need a reset event on at least one channel, and either reset
or no_data on the others.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">events = </span><span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span>
            <span class="nv">isResetEvent = </span><span class="s">&#39;reset&#39;</span> <span class="k">in</span> <span class="nx">events</span> <span class="o">and</span>
                           <span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="s">&#39;no_data&#39;</span><span class="p">]).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nx">isResetEvent</span> <span class="o">and</span> <span class="nx">models</span><span class="p">.</span><span class="nx">length</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>Render layout with "available" state flag</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@renderLayout</span> <span class="p">{</span><span class="nv">state: </span><span class="s">&#39;available&#39;</span><span class="p">}</span>
                <span class="nx">@insertItems</span><span class="p">(</span><span class="nx">models</span><span class="p">)</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Add a new item to a list by injecting a widget to the end of it</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="nx">item_params</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>Clear template blank state if previous state was "empty"
and no <em>reset</em> event has been triggered in the meantime
The "empty" state is also triggered at the end of scrolling,
so we need to check that there were no previous items before
emptying the template</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">@data_state</span> <span class="o">is</span> <span class="s">&#39;empty&#39;</span> <span class="o">and</span> <span class="nx">models</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                    <span class="nx">@renderLayout</span> <span class="p">{</span><span class="nv">state: </span><span class="s">&#39;available&#39;</span><span class="p">}</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>Create a dummy model id if missing. This can only happen if a
list is hosting client-side volatile data that is not synced
with a database (by adding to channel with sync: false)</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">unless</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="o">?</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>Prevent from triggering a change/change_attribute event
as well, by setting with silent: true</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">guid</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">),</span> <span class="nv">silent: </span><span class="kc">true</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">@matchesFilters</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
                    <span class="nx">@insertItem</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">models</span><span class="p">,</span> <span class="nv">isLoadedLater: </span><span class="kc">true</span><span class="p">)</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>If the event is <code>change_attribute</code>, check if the model matches the
filters and decide whether to add it or not</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="nx">item_params</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;change_attribute&#39;</span>
                <span class="k">if</span> <span class="nx">@matchesFilters</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>If we have a change in one of the sort_by attributes, we
need to remove this item and add it again, to go through
all the insert-in-sorted-place logic. And will be added
by the right below code again.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">item_params</span><span class="p">.</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">@getSortByFields</span><span class="p">()</span>
                        <span class="nx">@deleteItem</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>Don't create duplicates and add it only if it is unique</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.item-</span><span class="si">#{</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="nx">@insertItem</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">models</span><span class="p">)</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>Delete a specific item from a list</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="nx">item_params</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;remove&#39;</span>
                <span class="k">if</span> <span class="nx">@matchesFilters</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
                    <span class="nx">@deleteItem</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>

        <span class="nv">insertItems: </span><span class="nf">(models) -&gt;</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><p>Batch insert, for adding more models at the same time on
'reset' events. Useful for subclasses that might aggregate more
than one channel to build its list items</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@ids = </span><span class="p">[]</span></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><p>Insert each item one by one</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">models</span><span class="p">,</span> <span class="nf">(model) =&gt;</span>
                <span class="nx">@insertItem</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">models</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@matchesFilters</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>

        <span class="nv">insertItem: </span><span class="nf">(model, models, options = {}) =&gt;</span></pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><p>@param {Object} options
@param {Boolean} [options.isLoadedLater] - mark the item as being
loaded after view refresh</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="nx">options</span><span class="p">,</span>
                 <span class="nv">isLoadedLater: </span><span class="kc">false</span></pre></div></td></tr><tr id="section-45"><td class="docs"><div class="pilwrap"><a href="#section-45" class="pilcrow">&#182;</a></div><p>Find the name of the widget to insert.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">item = </span><span class="nx">@getItemWidgetName</span> <span class="nx">model</span></pre></div></td></tr><tr id="section-46"><td class="docs"><div class="pilwrap"><a href="#section-46" class="pilcrow">&#182;</a></div><p>Skip the insertion if widget not found</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="k">unless</span> <span class="nx">item</span><span class="o">?</span></pre></div></td></tr><tr id="section-47"><td class="docs"><div class="pilwrap"><a href="#section-47" class="pilcrow">&#182;</a></div><p>Extra params of the widget.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">extra_params = </span><span class="nx">_</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="s">&#39;isLoadedLater&#39;</span><span class="p">)</span>
            <span class="nv">item_widget_params = </span><span class="nx">@getItemWidgetParams</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">extra_params</span><span class="p">)</span></pre></div></td></tr><tr id="section-48"><td class="docs"><div class="pilwrap"><a href="#section-48" class="pilcrow">&#182;</a></div><p>Also add a class to uniquely identify the item
Needed when deleting the item from the list</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">item_class = </span><span class="s">&quot;item-</span><span class="si">#{</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nx">item_class</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">#{</span><span class="nx">@item_class</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">if</span> <span class="nx">@item_class</span><span class="o">?</span>

            <span class="nv">injectOptions =</span>
                <span class="nv">params: </span><span class="nx">item_widget_params</span>
                <span class="nv">container: </span><span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span>
                <span class="nv">type: </span><span class="nx">@item_element</span>
                <span class="nv">classes: </span><span class="nx">item_class</span>

            <span class="k">if</span> <span class="nx">@sort_by</span><span class="o">?</span>
                <span class="nv">firstModel = </span><span class="nx">@_findItemById</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">@ids</span><span class="p">))</span>
                <span class="nv">lastModel = </span><span class="nx">@_findItemById</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">@ids</span><span class="p">))</span></pre></div></td></tr><tr id="section-49"><td class="docs"><div class="pilwrap"><a href="#section-49" class="pilcrow">&#182;</a></div><p>No element so far means that the insertion is straight forward</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">@ids</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="nx">@ids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span></pre></div></td></tr><tr id="section-50"><td class="docs"><div class="pilwrap"><a href="#section-50" class="pilcrow">&#182;</a></div><p>Otherwise, see where in the list we can insert it
See if we must insert it before the first model</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="nx">@compare</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">firstModel</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                    <span class="nx">@ids</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
                    <span class="nv">injectOptions.placement = </span><span class="s">&#39;prepend&#39;</span></pre></div></td></tr><tr id="section-51"><td class="docs"><div class="pilwrap"><a href="#section-51" class="pilcrow">&#182;</a></div><p>See if we must insert it after the last model</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="nx">@compare</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">lastModel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="nx">@ids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span></pre></div></td></tr><tr id="section-52"><td class="docs"><div class="pilwrap"><a href="#section-52" class="pilcrow">&#182;</a></div><p>Otherwise, we're inserting it somewhere in the middle
Also, it means that we have at least two elements in
@ids (because if there is only one, the element e will
either be &lt;= it and be inserted before, or be > it and
be inserted after).</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span>
                    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@ids</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="nv">cur_model = </span><span class="nx">@_findItemById</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">@ids</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
                        <span class="nv">next_model = </span><span class="nx">@_findItemById</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">@ids</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nx">@compare</span><span class="p">(</span><span class="nx">cur_model</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">and</span>
                           <span class="nx">@compare</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">next_model</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                            <span class="nx">@ids</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span></pre></div></td></tr><tr id="section-53"><td class="docs"><div class="pilwrap"><a href="#section-53" class="pilcrow">&#182;</a></div><p>Insert before next_model's DOM element</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nv">injectOptions.container =</span>
                                <span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.item-</span><span class="si">#{</span><span class="nx">next_model</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
                            <span class="nv">injectOptions.placement = </span><span class="s">&#39;before&#39;</span>
                            <span class="k">break</span>

            <span class="nx">Utils</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">injectOptions</span><span class="p">)</span>
            <span class="nx">@updateFirstAndLastDOMClasses</span><span class="p">()</span>

        <span class="nv">getSortByFields: </span><span class="nf">-&gt;</span>
            <span class="nv">fields = </span><span class="p">[]</span>
            <span class="k">for</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">comparator</span> <span class="k">of</span> <span class="nx">@sort_by</span></pre></div></td></tr><tr id="section-54"><td class="docs"><div class="pilwrap"><a href="#section-54" class="pilcrow">&#182;</a></div><p>Make sure field is a string, and get the
field part of it (first part).</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">field = </span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="nx">field</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nx">fields</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
            <span class="nx">fields</span>

        <span class="nv">deleteItem: </span><span class="nf">(model) =&gt;</span></pre></div></td></tr><tr id="section-55"><td class="docs"><div class="pilwrap"><a href="#section-55" class="pilcrow">&#182;</a></div><p>Deletes a specific item from a list
Erase the ID of the model from the IDs array</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">idx = </span><span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@ids</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
            <span class="nx">@ids</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div></td></tr><tr id="section-56"><td class="docs"><div class="pilwrap"><a href="#section-56" class="pilcrow">&#182;</a></div><p>Remove the DOM element</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.item-</span><span class="si">#{</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>

            <span class="nx">@updateFirstAndLastDOMClasses</span><span class="p">()</span>

        <span class="nv">updateFirstAndLastDOMClasses: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-57"><td class="docs"><div class="pilwrap"><a href="#section-57" class="pilcrow">&#182;</a></div><p>Make sure the first and the last items of the list have a
'first' and 'last' class, respectively. This is useful for
older browser which do not support :first-child and :last-child
CSS selectors but also for cases where list items might have
neighbors of other types inside the list wrapper (in a
hypothetical list subclass scenario)
Only select first-level widgets (which means a list should never
have inner wrappers between its view element and its item widgets)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">$items = </span><span class="nx">@view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&#39;.mozaic-widget&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-58"><td class="docs"><div class="pilwrap"><a href="#section-58" class="pilcrow">&#182;</a></div><p>Clear all items of first/last classes first</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">$items</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;first&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;last&#39;</span><span class="p">)</span>
            <span class="nx">$items</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;first&#39;</span><span class="p">)</span>
            <span class="nx">$items</span><span class="p">.</span><span class="nx">last</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;last&#39;</span><span class="p">)</span>

        <span class="nv">getItemWidgetParams: </span><span class="nf">(model, extra_params) =&gt;</span></pre></div></td></tr><tr id="section-59"><td class="docs"><div class="pilwrap"><a href="#section-59" class="pilcrow">&#182;</a></div><p>Method returns the params of the item widget which will be inserted as part of the current list.
Can be overridden in specialiazed list classes to provide custom params to list items.
@param {Object} model Backbone.Model instance of the item to be inserted
@param {Object} extra_params - extra params to be passed to item widgets
@return {Object}</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">item_widget_params</span> <span class="o">=</span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">@widget_params</span><span class="p">,</span> <span class="nx">extra_params</span><span class="p">,</span>
                <span class="nv">id: </span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span>
                <span class="nv">channels: </span><span class="nx">@getItemWidgetChannels</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>

            <span class="nv">item_widget_params = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">item_widget_params</span><span class="p">,</span>
                                          <span class="nx">@itemParamsFromModel</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">@item_model_params</span><span class="p">))</span>

            <span class="nx">item_widget_params</span>

        <span class="nv">getItemWidgetName: </span><span class="nf">(model) -&gt;</span></pre></div></td></tr><tr id="section-60"><td class="docs"><div class="pilwrap"><a href="#section-60" class="pilcrow">&#182;</a></div><p>Get the widget name to inject. This could be found
in the mappings dict, using the object_class returned
from API, or if undefined, use the generic @item type
provided from parent.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">name = </span><span class="nx">@item</span> <span class="o">or</span> <span class="nx">@mappings</span><span class="o">?</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;object_class&#39;</span><span class="p">)]</span><span class="o">?</span><span class="p">.</span><span class="nx">item</span>
            <span class="k">unless</span> <span class="nx">name</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;The list cannot render a model with no specified type.&quot;</span>
            <span class="k">return</span> <span class="nx">name</span>

        <span class="nv">getItemWidgetChannels: </span><span class="nf">(model) -&gt;</span>
            <span class="nx">@item_channels</span> <span class="o">or</span> <span class="nx">@mappings</span><span class="o">?</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;object_class&#39;</span><span class="p">)]</span><span class="o">?</span><span class="p">.</span><span class="nx">item_channels</span>

        <span class="nv">itemParamsFromModel: </span><span class="nf">(model, dict = {}) -&gt;</span>
            <span class="nv">response = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="p">(</span><span class="nx">@item_params</span> <span class="o">or</span>
                                     <span class="nx">@mappings</span><span class="o">?</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;object_class&#39;</span><span class="p">)]</span><span class="o">?</span><span class="p">.</span><span class="nx">item_params</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">new_key</span> <span class="k">of</span> <span class="nx">dict</span>
                <span class="nv">data = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
                <span class="nx">response</span><span class="p">[</span><span class="nx">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span> <span class="k">if</span> <span class="nx">data</span>
            <span class="k">return</span> <span class="nx">response</span>

        <span class="nv">extendWidgetParamsFromItem: </span><span class="o">=&gt;</span></pre></div></td></tr><tr id="section-61"><td class="docs"><div class="pilwrap"><a href="#section-61" class="pilcrow">&#182;</a></div><p>User can send an item_params which is send in as params in items</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">@widget_params</span><span class="p">,</span> <span class="nx">@item_params</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@item_params</span><span class="o">?</span>

        <span class="nv">getModelsFromChannelData: </span><span class="nf">(item_params) -&gt;</span></pre></div></td></tr><tr id="section-62"><td class="docs"><div class="pilwrap"><a href="#section-62" class="pilcrow">&#182;</a></div><p>Get models from one or more channel events. The default list
implementation only uses an /items channel to draw its items
from</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">item_params</span><span class="p">.</span><span class="nx">collection</span><span class="o">?</span><span class="p">.</span><span class="nx">models</span> <span class="o">or</span> <span class="p">[]</span>

        <span class="nv">_findItemById: </span><span class="nf">(list, id) -&gt;</span></pre></div></td></tr><tr id="section-63"><td class="docs"><div class="pilwrap"><a href="#section-63" class="pilcrow">&#182;</a></div><p>Find an item from a sorted list, by id
Note: _.findWhere(list, id: id) can be used once we update to
Underscore 1.4.4: http://underscorejs.org/#findWhere</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nf">(item) -&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="o">is</span> <span class="nx">id</span><span class="p">)</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:31 GMT+0300 (EEST)  </div></div></body></html>