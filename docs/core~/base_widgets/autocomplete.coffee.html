<!DOCTYPE html><html><head><title>autocomplete.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source selected"><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>autocomplete.coffee</h1><div class="filepath">core~/base_widgets/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!widget&#39;</span><span class="p">],</span> <span class="nf">(Widget) -&gt;</span>

    <span class="k">class</span> <span class="nx">AutocompleteWidget</span> <span class="k">extends</span> <span class="nx">Widget</span>

        <span class="nv">elements:</span>
            <span class="nv">input: </span><span class="s">&#39;input.search-box&#39;</span>
            <span class="nv">list: </span><span class="s">&#39;ul.results&#39;</span>
            <span class="nv">items: </span><span class="s">&#39;ul.results li&#39;</span>

        <span class="nv">events:</span>
            <span class="s">&#39;keydown @input&#39;</span><span class="o">:</span> <span class="s">&#39;onKeyDown&#39;</span>
            <span class="s">&#39;keyup @input&#39;</span><span class="o">:</span> <span class="s">&#39;onKeyUp&#39;</span>
            <span class="s">&#39;mouseenter @items&#39;</span><span class="o">:</span> <span class="s">&#39;onMouseEnter&#39;</span>
            <span class="s">&#39;click @items&#39;</span><span class="o">:</span> <span class="s">&#39;onItemClick&#39;</span>
        <span class="nv">limit: </span><span class="mi">8</span>
        <span class="nv">activeClass: </span><span class="s">&#39;active&#39;</span>

        <span class="nv">setup: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Setup method, has to be run internally,
after layout render
Init empty query if not already defined</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@query = </span><span class="nx">@query</span> <span class="o">or</span> <span class="s">&#39;&#39;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Assign previous value to input (if any)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">@query</span><span class="p">)</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Create initial reults selection, as all items</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@results = </span><span class="nx">@items</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Implicitly hightlight first result</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@highlight</span> <span class="nx">@results</span><span class="p">.</span><span class="nx">first</span><span class="p">()</span>

        <span class="nv">onKeyDown: </span><span class="nf">(e) =&gt;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Event handler for input key down</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>
                <span class="k">when</span> <span class="mi">13</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>ENTER</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
                <span class="k">when</span> <span class="mi">27</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>ESCAPE</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
                <span class="k">when</span> <span class="mi">38</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>UP</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@prev</span><span class="p">()</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
                <span class="k">when</span> <span class="mi">40</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>DOWN</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@next</span><span class="p">()</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

            <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>

        <span class="nv">onKeyUp: </span><span class="nf">(e) =&gt;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Event handler for input key up</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>
                <span class="k">when</span> <span class="mi">13</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>ENTER</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@select</span> <span class="nx">@active</span>

                <span class="k">when</span> <span class="mi">27</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>ESCAPE</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@close</span><span class="p">()</span>
                <span class="k">else</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Uncaught key, filter results
if query changed.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">@query</span> <span class="o">!=</span> <span class="p">(</span><span class="vi">@query = </span><span class="nx">@input</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span>
                        <span class="nx">@filter</span><span class="p">()</span>

            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>

        <span class="nv">onMouseEnter: </span><span class="nf">(e) =&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Event handler for list hover</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@highlight</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">),</span> <span class="kc">true</span>

        <span class="nv">onItemClick: </span><span class="nf">(e) =&gt;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Event handler for list item click</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@select</span> <span class="nx">$</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span>
            <span class="kc">false</span>

        <span class="nv">open: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Open results
Extend and call in subclass per needs.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">close: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Close results
Extend and call in subclass per needs.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@input</span><span class="p">.</span><span class="nx">val</span> <span class="vi">@query = </span><span class="s">&#39;&#39;</span>

        <span class="nv">filter: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Filter available options with user input
Filter loose matches</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@results = </span><span class="nx">@items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(i, item) =&gt;</span> <span class="nx">@match</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Sort results</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@results</span><span class="p">.</span><span class="nx">sort</span> <span class="nf">(a, b) =&gt;</span> <span class="nx">@sort</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Limit matches</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@results = </span><span class="nx">@results</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@limit</span> <span class="k">if</span> <span class="nx">@limit</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Physically arrange sorted selection</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@results</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(i, item) =&gt;</span>
                <span class="nx">@list</span><span class="p">.</span><span class="nx">append</span> <span class="nx">item</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Show matches</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@items</span><span class="p">.</span><span class="nx">hide</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">@results</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Make first remaining element active</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@highlight</span> <span class="k">if</span> <span class="nx">@results</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">@results</span><span class="p">.</span><span class="nx">first</span><span class="p">()</span> <span class="k">else</span> <span class="nx">$</span><span class="p">()</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Update widget's tiny scrollbar</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">Utils</span><span class="p">.</span><span class="nx">renderScrollbar</span><span class="p">(</span><span class="nx">@el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.tiny_scrollbar&#39;</span><span class="p">))</span>

        <span class="nv">sort: </span><span class="nf">(a, b, element = true) -&gt;</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Sort between items</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Make sure the all<em>items elem is always first
The all</em>items 'li' must have option='all' for the sorting to work</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">element</span>
                <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s">&#39;option&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;all&#39;</span> <span class="o">or</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s">&#39;option&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;all&#39;</span> <span class="o">or</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Fetch values</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">aValue = </span><span class="k">if</span> <span class="nx">element</span> <span class="k">then</span> <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span> <span class="k">else</span> <span class="nx">a</span>
            <span class="nv">bValue = </span><span class="k">if</span> <span class="nx">element</span> <span class="k">then</span> <span class="nx">$</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span> <span class="k">else</span> <span class="nx">b</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Prioritize strict matches</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">aStrict = </span><span class="nx">@compare</span> <span class="nx">aValue</span><span class="p">,</span> <span class="kc">true</span>
            <span class="nv">bStrict = </span><span class="nx">@compare</span> <span class="nx">bValue</span><span class="p">,</span> <span class="kc">true</span>

            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">aStrict</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">bStrict</span>
            <span class="k">return</span> <span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">bStrict</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">aStrict</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Then loose matches</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">aLoose = </span><span class="nx">@compare</span> <span class="nx">aValue</span><span class="p">,</span> <span class="kc">false</span>
            <span class="nv">bLoose = </span><span class="nx">@compare</span> <span class="nx">bValue</span><span class="p">,</span> <span class="kc">false</span>

            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">aLoose</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">bLoose</span>
            <span class="k">return</span> <span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">bLoose</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">aLoose</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Fallback alphabetically</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">aValue</span> <span class="o">&lt;</span> <span class="nx">bValue</span>
            <span class="k">return</span> <span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">aValue</span> <span class="o">&gt;</span> <span class="nx">bValue</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Draw</p>
</td><td class="code"><div class="highlight"><pre>            <span class="mi">0</span>

        <span class="nv">match: </span><span class="nf">(item, strict = false) -&gt;</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>Match function</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Hide default value when query is not empty</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@query</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">data</span> <span class="s">&#39;value&#39;</span>
                <span class="k">return</span> <span class="kc">false</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>Create keywords array
Need to convert to String because boolean and numeric
values are evaluated to their respective types, in which
case split() breaks.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">keywords = </span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;keywords&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="p">)).</span><span class="nx">split</span><span class="p">()</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>Add value and text to keyword array</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">keywords</span><span class="p">.</span><span class="nx">push</span> <span class="nb">String</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="nx">keywords</span><span class="p">.</span><span class="nx">push</span> <span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>Search for matches in all keywords</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">keyword</span> <span class="k">in</span> <span class="nx">keywords</span>
                <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">keyword</span> <span class="o">and</span> <span class="nx">@compare</span> <span class="nx">keyword</span><span class="p">,</span> <span class="nx">strict</span>
            <span class="kc">false</span>

        <span class="nv">compare: </span><span class="nf">(value, strict) -&gt;</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>String compare function
Searches value within query.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">strict</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="o">~</span><span class="nx">value</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span>

        <span class="nv">highlight: </span><span class="nf">(element) -&gt;</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>Make element active
Caution when extending, function must
return active element.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@active = </span><span class="nx">element</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>Add CSS class (also returns @active element)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@items</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">@activeClass</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">@active</span><span class="p">).</span><span class="nx">addClass</span> <span class="nx">@activeClass</span>

        <span class="nv">prev: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>Highlight previous element</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">@highlight</span> <span class="nx">@active</span><span class="p">.</span><span class="nx">prev</span> <span class="s">&#39;:visible&#39;</span><span class="p">).</span><span class="nx">length</span>
                <span class="nx">@highlight</span> <span class="nx">@results</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span>

        <span class="nv">next: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><p>Highlight previous element</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">@highlight</span> <span class="nx">@active</span><span class="p">.</span><span class="nx">next</span> <span class="s">&#39;:visible&#39;</span><span class="p">).</span><span class="nx">length</span>
                <span class="nx">@highlight</span> <span class="nx">@results</span><span class="p">.</span><span class="nx">first</span><span class="p">()</span>

        <span class="nv">select: </span><span class="nf">(element) -&gt;</span></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><p>Select element
Extend in subclass per needs.
Close results</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@close</span><span class="p">()</span>

    <span class="k">return</span> <span class="nx">AutocompleteWidget</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:30 GMT+0300 (EEST)  </div></div></body></html>