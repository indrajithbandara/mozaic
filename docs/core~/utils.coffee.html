<!DOCTYPE html><html><head><title>utils.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../core~/utils.coffee.html" class="source selected"><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>utils.coffee</h1><div class="filepath">core~/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!utils/urls&#39;</span><span class="p">,</span> <span class="s">&#39;cs!utils/time&#39;</span><span class="p">,</span> <span class="s">&#39;cs!utils/dom&#39;</span><span class="p">,</span> <span class="s">&#39;cs!utils/images&#39;</span><span class="p">,</span> <span class="s">&#39;cs!utils/misc&#39;</span><span class="p">],</span> <span class="nf">(Urls, Time, Dom, Images, Misc) -&gt;</span>
    <span class="nv">Utils =</span>
        <span class="nv">title: </span><span class="p">{}</span>

        <span class="nv">guid: </span><span class="nf">(name) -&gt;</span>
            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>

        <span class="nv">inject: </span><span class="nf">(widgetName, options = {}) -&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Inject a widget dynamically, under a specified container
element or inside a modal window.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>The container option can be either a string, an HTML element
or a jQuery selector, and will end up casted as a jQuery
selector either way. If no container is specified the widget
will be opened inside a modal and a <code>modalTitle</code> option should
be specified for it.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Example:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><h1>Inject widget in container</h1>

<p>Utils.inject('item-count',
container: '.item-count-container'
params:
channels: ...
)</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><h1>Inject widget in modal</h1>

<p>Utils.inject('item-count',
modalTitle: 'Here is an Item Count'
params:
channels: ...
)</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>@param (string) widgetName The name of the widget to be injected
(defined in the modules.js mappings)
@param (object) options Extra options for injecting the widgets,
here are the available ones:
- (string) id The id attribute
- (string) type of DOM element to inject
- (string) classes Extra set of classes
- (object) data Extra set of data attributes (the <code>widget</code>
and <code>params</code> keys are reserved for the widget
name and params respectively and thus will be
overwritten is present)
- (object) params The data params that the widget will
receive, they will be strigified and passed
through the <code>data-params</code> attribute
- (string|HTML|jQuery) container Where in the DOM to inject
the widget at (a modal will
be used if not specified)
- (string) modalTitle Fallbacks to widgetName when missing
and ignored when using a container
- (object) modalParams A different set of params for the modal
widget itself
- (string) placement Method of injecting:
- replace: Inside container, replaces its current contents
- before - Outside container, before it
- after - Outside container, after it
- prepend - Inside container, first element
- append (default) - Inside container, last element</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>@return (bool|HTML) false on failure or the HTML element on
success
No need to validate container if we're not using one (using modal
instead)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="o">?</span>
                <span class="nv">container = </span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Force casting of element into a jQuery selector</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">unless</span> <span class="p">(</span><span class="nx">container</span> <span class="k">instanceof</span> <span class="nx">jQuery</span><span class="p">)</span>
                    <span class="nv">container = </span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>No need to create widget if the container is invalid. Also make
sure to return a false value in this case</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">container</span><span class="p">.</span><span class="nx">length</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Build DOM element based on the widget options</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">options.name = </span><span class="nx">widgetName</span>
            <span class="nv">node = </span><span class="nx">@_buildDomElementByWidgetOptions</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Inject into existing on container or fire up a modal with the
newly created widget, based on the existence of a container option</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">container</span><span class="o">?</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Choose where and how to inject the created DOM element based on
the specified container and related options</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">placement</span> <span class="o">is</span> <span class="s">&#39;replace&#39;</span>
                    <span class="nx">container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="nx">container</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">placement</span> <span class="o">or</span> <span class="s">&#39;append&#39;</span><span class="p">](</span><span class="nx">node</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
                <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s">&#39;/modal&#39;</span><span class="p">,</span>
                    <span class="nv">html: </span><span class="nx">node</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Deprecated: The modal window widget uses this for adding
a class to the modal, based on the injected widget.
Should be part of the modalParams</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">data_widget: </span><span class="nx">widgetName</span>
                    <span class="nv">title: </span><span class="nx">options</span><span class="p">.</span><span class="nx">modalTitle</span> <span class="o">or</span> <span class="nx">widgetName</span>
                    <span class="nv">params: </span><span class="nx">options</span><span class="p">.</span><span class="nx">modalParams</span> <span class="o">or</span> <span class="p">{}</span>
                <span class="p">)</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Return created widget DOM element on success</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">node</span>

        <span class="nv">buildDomElement: </span><span class="nf">(type, id, classes, data) -&gt;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Build DOM element based on a specified type, id, list of
classes and a data dict. Only the type is required.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">node = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;</span><span class="si">#{</span><span class="nx">type</span><span class="si">}</span><span class="s">&gt;&lt;/</span><span class="si">#{</span><span class="nx">type</span><span class="si">}</span><span class="s">&gt;&quot;</span><span class="p">)</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="k">if</span> <span class="nx">id</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">,</span> <span class="nx">classes</span><span class="p">)</span> <span class="k">if</span> <span class="nx">classes</span>
            <span class="k">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
                <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">data</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Strings get an extra set of quotes when they get
stringified, so we should only stringify objects</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">v = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;data-</span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">node</span>

        <span class="nv">onWidgetRender: </span><span class="nf">(widgetName, parentWidget, onRender) -&gt;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Run a callback after a specific widget type rendered, that has
not been injected manually from a test but rather consequently,
from inside a parent widget injected manually.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>The 1st parameter can be left null if looking for more than one
type of widget and all widgets will be sent to the onRender
callback once rendered. The name of the widget will be sent as
a second parameter to the callback for ease of use.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>The 2nd parameter allows us to specify the parent widget
instance, in order to make sure we're not intercepting a
different widget of the same type loading somewhere else.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>This method subscribes to /new<em>widget</em>rendered pubsub events
and keeps listening until the onRender callback returns true,
this way allowing the user to listen to one or more widgets of
a type to load before testing something.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
            <span class="nv">f = </span><span class="nf">(widget_id, widget_name) =&gt;</span>
                <span class="nv">widget = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">widget_id</span><span class="p">]</span>
                <span class="k">return</span> <span class="k">if</span> <span class="nx">widgetName</span> <span class="o">and</span> <span class="nx">widget_name</span> <span class="o">isnt</span> <span class="nx">widgetName</span>
                <span class="k">return</span> <span class="k">if</span> <span class="nx">parentWidget</span> <span class="o">and</span>
                          <span class="o">not</span> <span class="nx">parentWidget</span><span class="p">.</span><span class="nx">view</span><span class="o">?</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">$el</span><span class="p">).</span><span class="nx">length</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>This handler can be removed automatically by returning true
from inside the callback function</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">onRender</span><span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">widget_name</span><span class="p">)</span>
                    <span class="nx">pipe</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="s">&#39;/new_widget_rendered&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>

            <span class="nx">pipe</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s">&#39;/new_widget_rendered&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>return event handler so it can be removed by hand as well, from
the place this was registered</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">f</span>

        <span class="nv">injectWidget: </span><span class="nf">(el, widget_name, params, extra_classes = null, clean = null, el_type = null, modal = false, prepend = false, before = false, after = false) -&gt;</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>@deprecated</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Utils.inject should be used in favor of this one,
but it cannot yet be removed in order to provide backwards
compatibility to all existing widgets.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>TODO: This should be changed to use the new Utils.inject
internally in order to speed up the migration process of these
two methods.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Inject a given widget under the DOM element el, given its name
and initial params. You can pass an additional modal argument
to inject the widget in a modal window. The modal will inject the
html in it's body</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>el: the element where the widget will be inserted. should be a jQuery selector
widget<em>name: the name/type of the widget
params: data that will be passed to the widget
extra</em>classes: additional css classes, default is none
clean: specifies if the new widget should replace whatever is in el or be appended to it
el_type: type of element to be rendered (e.g. div, ul, li)
prepend: use prepend instead of append
before: insert BEFORE element (as a sibling of the element)
after: insert AFTER element (as a sibling of the element)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">stringified_params = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
            <span class="nv">classes = </span><span class="k">if</span> <span class="nx">extra_classes</span> <span class="k">then</span> <span class="s">&quot;mozaic-widget </span><span class="si">#{</span><span class="nx">extra_classes</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="s">&quot;mozaic-widget&quot;</span>
            <span class="nv">type = </span><span class="k">if</span> <span class="nx">el_type</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">el_type</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="s">&quot;div&quot;</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Escape stringified_params to avoid html rendering errors</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">stringified_params = </span><span class="nx">_</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">stringified_params</span><span class="p">)</span>

            <span class="nv">html = </span><span class="s">&quot;&lt;</span><span class="si">#{</span><span class="nx">type</span><span class="si">}</span><span class="s"></span>
<span class="s">                        class=&#39;</span><span class="si">#{</span><span class="nx">classes</span><span class="si">}</span><span class="s">&#39;</span>
<span class="s">                        data-widget=&#39;</span><span class="si">#{</span><span class="nx">widget_name</span><span class="si">}</span><span class="s">&#39;</span>
<span class="s">                        data-params=&#39;</span><span class="si">#{</span><span class="nx">stringified_params</span><span class="si">}</span><span class="s">&#39;</span>
<span class="s">                    &gt;&lt;/</span><span class="si">#{</span><span class="nx">type</span><span class="si">}</span><span class="s">&gt;&quot;</span>

            <span class="k">if</span> <span class="o">not</span> <span class="nx">modal</span>
                <span class="k">if</span> <span class="nx">clean</span><span class="o">?</span> <span class="o">and</span> <span class="nx">clean</span>
                    <span class="nx">el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="k">if</span> <span class="nx">before</span>
                        <span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="nx">after</span>
                        <span class="nx">el</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="nx">prepend</span>
                        <span class="nx">el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                    <span class="k">else</span>
                        <span class="nx">el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
                <span class="nv">title = </span><span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">title</span><span class="o">?</span> <span class="k">then</span> <span class="nx">params</span><span class="p">.</span><span class="nx">title</span> <span class="k">else</span> <span class="nx">widget_name</span>
                <span class="nv">modal_params = </span><span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">modal_params</span><span class="o">?</span> <span class="k">then</span> <span class="nx">params</span><span class="p">.</span><span class="nx">modal_params</span>
                <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span> <span class="s">&#39;/modal&#39;</span><span class="p">,</span>
                    <span class="nv">html: </span><span class="nx">html</span>
                    <span class="nv">title: </span><span class="nx">title</span>
                    <span class="nv">data_widget: </span><span class="nx">widget_name</span>
                    <span class="nv">params: </span><span class="nx">modal_params</span>

        <span class="nv">findObjectKey: </span><span class="nf">(obj, val) -&gt;</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Given an object, find the key for a value.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">prop</span> <span class="k">of</span> <span class="nx">obj</span>
                <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">==</span> <span class="nx">val</span>
                    <span class="k">return</span> <span class="nx">prop</span>

        <span class="nv">pathIsExpandable: </span><span class="nf">(path, separator = &#39;/&#39;) -&gt;</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Returns true if a given XPath-like expression is expandable.
This means that the path will match all the children of the
given path.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)</span>

        <span class="nv">expandPath: </span><span class="nf">(path, obj, separator = &#39;/&#39;) -&gt;</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>Expands a given XPath-like expression into 0 or more expressions
that match both the path containing wildcards and the
underlying object.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>Non-expandable paths are expanded into themselves</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">pathIsExpandable</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="nx">path</span><span class="p">]</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Otherwise, append to the parent path all children</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">parent_path = </span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">rtrim</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;/*&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">])</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>If path is * then return paths to obj keys</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">parent_path</span> <span class="o">is</span> <span class="s">&#39;&#39;</span>
                <span class="nv">subset = </span><span class="nx">obj</span>
            <span class="k">else</span>
                <span class="nv">subset = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">getNestedAttr</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">parent_path</span><span class="p">)</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>If you try to expand a leaf then the path to
leaf is returned as response</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="p">[</span><span class="nx">parent_path</span><span class="p">]</span> <span class="k">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">subset</span><span class="p">)</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>Build all the paths</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">paths = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">subset</span><span class="p">),</span> <span class="nf">(key) -&gt;</span>
                <span class="nx">path</span> <span class="o">=</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;/&#39;</span> <span class="p">,</span> <span class="nx">parent_path</span><span class="p">,</span> <span class="nx">key</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>Remove the leading slashes that can occur when you get
all paths from root</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">ltrim</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="nx">paths</span>

        <span class="nv">getNestedAttr: </span><span class="nf">(obj, path, separator = &#39;/&#39;) -&gt;</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>Get a value of a sub-set of the data.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>path: a "path" with items separated by separator (e.g. "/")
Returns: the data at the given path or null</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">result = </span><span class="nx">obj</span>
            <span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">separator</span><span class="p">)</span>
                <span class="nv">result = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">getAttributeFromModel</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">field</span><span class="p">)</span>
            <span class="nx">result</span>

        <span class="nv">attachCallback: </span><span class="nf">(object, method_names, callback) -&gt;</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>Attach callback to object method(s), that will
run right after each of the selected methods</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><p>object: The object of the methods
method_names: Space-separated list of method names
callback: Callback function to be attached</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><p>TODO: Add extra param for before/after callback positioning</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">methods = </span><span class="p">(</span><span class="nx">name</span> <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">method_names</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="k">when</span> <span class="nx">object</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span>

            <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span> <span class="k">of</span> <span class="nx">methods</span></pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><p>Create different scope for each ref var, otherwise the all
the methods would reference to the last assigned value only</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">do</span><span class="nf">(name) -&gt;</span>
                    <span class="nv">ref = </span><span class="nx">object</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
                    <span class="nx">object</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">-&gt;</span>
                        <span class="nv">return_value = </span><span class="nx">ref</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
                        <span class="nx">callback</span><span class="p">()</span>
                        <span class="k">return</span> <span class="nx">return_value</span>

        <span class="nv">newDataChannels: </span><span class="nf">(types...) -&gt;</span></pre></div></td></tr><tr id="section-45"><td class="docs"><div class="pilwrap"><a href="#section-45" class="pilcrow">&#182;</a></div><p>Returns a set of new data channel GUIDs, given their types.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-46"><td class="docs"><div class="pilwrap"><a href="#section-46" class="pilcrow">&#182;</a></div><p>How to call this:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-47"><td class="docs"><div class="pilwrap"><a href="#section-47" class="pilcrow">&#182;</a></div><p>First version - without initial parameters for the data channels
[mentions, tags, users] = @newDataChannels('/mentions', '/tags', '/users')</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-48"><td class="docs"><div class="pilwrap"><a href="#section-48" class="pilcrow">&#182;</a></div><p>Second version - with initial parameters for the data channels
[mentions, tags, users] = @newDataChannels({'/mentions': {'gender': 'f', 'sentiment': 'positive'}, '/tags': {}, '/users': {}})</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-49"><td class="docs"><div class="pilwrap"><a href="#section-49" class="pilcrow">&#182;</a></div><p>TODO: fix the flaw that we can't create multiple /mentions channels with the same call.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-50"><td class="docs"><div class="pilwrap"><a href="#section-50" class="pilcrow">&#182;</a></div><p>Make sure that all params are in fact passed as a dict, regardless
of the calling convention actually used.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="nv">types_dict = </span><span class="nx">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span>
                <span class="nv">types_dict = </span><span class="p">{}</span>
                <span class="k">for</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">types</span>
                    <span class="nx">types_dict</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="nv">channels = </span><span class="p">{}</span>
            <span class="nv">guids = </span><span class="p">[]</span>
            <span class="k">for</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">params</span> <span class="k">of</span> <span class="nx">types_dict</span>
                <span class="nv">guid = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">guid</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span>
                <span class="nx">channels</span><span class="p">[</span><span class="nx">guid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nv">type: </span><span class="nx">type</span><span class="p">,</span> <span class="nv">params: </span><span class="nx">params</span><span class="p">}</span>
                <span class="nx">guids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">guid</span><span class="p">)</span></pre></div></td></tr><tr id="section-51"><td class="docs"><div class="pilwrap"><a href="#section-51" class="pilcrow">&#182;</a></div><p>Notify the datasource that we need new channels</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
            <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s">&#39;/new_data_channels&#39;</span><span class="p">,</span> <span class="nx">channels</span><span class="p">)</span>
            <span class="nx">guids</span>

        <span class="nv">goto: </span><span class="nf">(hashbang, trigger = false) -&gt;</span></pre></div></td></tr><tr id="section-52"><td class="docs"><div class="pilwrap"><a href="#section-52" class="pilcrow">&#182;</a></div><p>Run the navigate() method of backbone router to navigate to the new URL.
Make sure we don't trigger a new router match.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">router = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;cs!router&#39;</span><span class="p">)</span>
            <span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">hashbang</span><span class="p">,</span> <span class="p">{</span><span class="nv">trigger: </span><span class="nx">trigger</span><span class="p">})</span>

        <span class="nv">notifyFilterChanges: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-53"><td class="docs"><div class="pilwrap"><a href="#section-53" class="pilcrow">&#182;</a></div><p>nothing for now</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">notify: </span><span class="nf">(message, type = &#39;notice&#39;) -&gt;</span></pre></div></td></tr><tr id="section-54"><td class="docs"><div class="pilwrap"><a href="#section-54" class="pilcrow">&#182;</a></div><p>Displays a notification message.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-55"><td class="docs"><div class="pilwrap"><a href="#section-55" class="pilcrow">&#182;</a></div><p>Supported types:
- loading
- status
- success
- error
- notice</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-56"><td class="docs"><div class="pilwrap"><a href="#section-56" class="pilcrow">&#182;</a></div><p><em>loading</em> and <em>status</em> are special types that do not remove
themselves automatically after a period of time.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-57"><td class="docs"><div class="pilwrap"><a href="#section-57" class="pilcrow">&#182;</a></div><p>Any other type can be used if there's a corresponding
CSS class to represent it accordingly.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-58"><td class="docs"><div class="pilwrap"><a href="#section-58" class="pilcrow">&#182;</a></div><p>@see notifications.coffee
Get pubsub pipe</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-59"><td class="docs"><div class="pilwrap"><a href="#section-59" class="pilcrow">&#182;</a></div><p>Publish through /notifications channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s">&#39;/notifications&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">type: </span><span class="nx">type</span><span class="p">,</span> <span class="nv">message: </span><span class="nx">message</span> <span class="p">})</span>

        <span class="nv">setTitle: </span><span class="nf">(params) -&gt;</span></pre></div></td></tr><tr id="section-60"><td class="docs"><div class="pilwrap"><a href="#section-60" class="pilcrow">&#182;</a></div><p>Dinamically modify page title name when navigating through site
by creating a dict with current page title and count (if keyword)</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-61"><td class="docs"><div class="pilwrap"><a href="#section-61" class="pilcrow">&#182;</a></div><p>The method can be called with a null parameter in order to reset
the current ones</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">params</span><span class="o">?</span>
                <span class="vi">@title = </span><span class="p">{}</span>
            <span class="k">else</span></pre></div></td></tr><tr id="section-62"><td class="docs"><div class="pilwrap"><a href="#section-62" class="pilcrow">&#182;</a></div><p>Reset count if a new page has been specified</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">delete</span> <span class="nx">@title</span><span class="p">.</span><span class="nx">count</span> <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">page</span></pre></div></td></tr><tr id="section-63"><td class="docs"><div class="pilwrap"><a href="#section-63" class="pilcrow">&#182;</a></div><p>Allow only some parameters to be modified</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">allowed_title_parameters = </span><span class="p">[</span><span class="s">&#39;page&#39;</span><span class="p">,</span> <span class="s">&#39;count&#39;</span><span class="p">]</span>
                <span class="nv">params = </span><span class="nx">_</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">allowed_title_parameters</span><span class="p">...)</span></pre></div></td></tr><tr id="section-64"><td class="docs"><div class="pilwrap"><a href="#section-64" class="pilcrow">&#182;</a></div><p>Update cached copy of title params</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">@title</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span></pre></div></td></tr><tr id="section-65"><td class="docs"><div class="pilwrap"><a href="#section-65" class="pilcrow">&#182;</a></div><p>A standard page title has the following form:
      ({{count}}) {{page}}
  Count is set when streampoll gets data (if it is 0 is now shown)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@title</span><span class="p">.</span><span class="nx">page</span>
                <span class="nv">title = </span><span class="nx">@title</span><span class="p">.</span><span class="nx">page</span>
                <span class="nv">title = </span><span class="s">&quot;(</span><span class="si">#{</span><span class="nx">@title</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span><span class="s">) </span><span class="si">#{</span><span class="nx">title</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">if</span> <span class="nx">@title</span><span class="p">.</span><span class="nx">count</span>
            <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nv">title = </span><span class="nx">title</span>

        <span class="nv">clearNotifications: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-66"><td class="docs"><div class="pilwrap"><a href="#section-66" class="pilcrow">&#182;</a></div><p>Clear all notifications, regardless of the
"loading" stashed count</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-67"><td class="docs"><div class="pilwrap"><a href="#section-67" class="pilcrow">&#182;</a></div><p>@see notifications.coffee
Get pubsub pipe</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-68"><td class="docs"><div class="pilwrap"><a href="#section-68" class="pilcrow">&#182;</a></div><p>Publish through /notifications channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s">&#39;/notifications&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">type: </span><span class="s">&#39;clear_all&#39;</span> <span class="p">})</span>

        <span class="nv">closeModal: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-69"><td class="docs"><div class="pilwrap"><a href="#section-69" class="pilcrow">&#182;</a></div><p>Close any opened modal window by publishing an empty message
on the '/closemodal' channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">pipe = </span><span class="nx">loader</span><span class="p">.</span><span class="nx">get_module</span><span class="p">(</span><span class="s">&#39;pubsub&#39;</span><span class="p">)</span>
            <span class="nx">pipe</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s">&#39;/closemodal&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="nv">createModuleInstance: </span><span class="nf">(Module, params, tpl) -&gt;</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">Module</span><span class="p">)</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Trying to instantiate something uninstantiable&quot;</span><span class="p">,</span>
                             <span class="nx">Module</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nx">Mozaic</span><span class="p">.</span><span class="nx">execute</span> <span class="p">(</span><span class="nf">-&gt;</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">Module</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">tpl</span><span class="p">)),</span></pre></div></td></tr><tr id="section-70"><td class="docs"><div class="pilwrap"><a href="#section-70" class="pilcrow">&#182;</a></div><p>Provide attributes for extra context in case of an error</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">action: </span><span class="s">&#39;Instantiating module&#39;</span>
                    <span class="nv">module: </span><span class="nx">Module</span><span class="p">.</span><span class="nx">name</span></pre></div></td></tr><tr id="section-71"><td class="docs"><div class="pilwrap"><a href="#section-71" class="pilcrow">&#182;</a></div><p>Remove jQuery element (there shouldn't be any circular
dependency in this params so that they can be
JSON-encoded and logged along with a possible exception</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">params: </span><span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="s">&#39;el&#39;</span><span class="p">)</span>
                    <span class="nv">template: </span><span class="nx">tpl</span>

        <span class="nv">mixin: </span><span class="nf">(mixins..., classReference) -&gt;</span></pre></div></td></tr><tr id="section-72"><td class="docs"><div class="pilwrap"><a href="#section-72" class="pilcrow">&#182;</a></div><p>Mixin a class methods into another. Doesn't work with
our wrapInstanceHelper.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-73"><td class="docs"><div class="pilwrap"><a href="#section-73" class="pilcrow">&#182;</a></div><p>TODO: It can work if we inspect a
mixing property of a module in wrapInstanceHelper ...</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">mixin</span> <span class="k">in</span> <span class="nx">mixins</span>
                <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nv">mixin::</span>
                    <span class="nv">classReference.key = </span><span class="nx">value</span>
            <span class="nx">classReference</span>

        <span class="nv">titleize: </span><span class="nf">(name, opts = {}) =&gt;</span></pre></div></td></tr><tr id="section-74"><td class="docs"><div class="pilwrap"><a href="#section-74" class="pilcrow">&#182;</a></div><p>Return a string with all its words capitalized. E.g.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-75"><td class="docs"><div class="pilwrap"><a href="#section-75" class="pilcrow">&#182;</a></div><p>Utils.titleize('a little Shit')
-> "A Little Shit"</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">words = </span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39; &#39;</span>
            <span class="nv">keepLowerCase = </span><span class="nx">opts</span><span class="p">.</span><span class="nx">keepLowerCase</span> <span class="o">||</span> <span class="p">[</span><span class="s">&#39;and&#39;</span><span class="p">,</span> <span class="s">&#39;the&#39;</span><span class="p">,</span> <span class="s">&#39;of&#39;</span><span class="p">]</span>
            <span class="nv">titleWords = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">words</span><span class="p">,</span> <span class="nf">(w) -&gt;</span>
               <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">keepLowerCase</span><span class="p">,</span> <span class="nx">w</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                   <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
               <span class="k">else</span>
                   <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">titleize</span> <span class="nx">w</span>

            <span class="k">return</span> <span class="nx">titleWords</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39; &#39;</span>

        <span class="nv">getAttributeFromModel: </span><span class="nf">(model, key, params...) -&gt;</span></pre></div></td></tr><tr id="section-76"><td class="docs"><div class="pilwrap"><a href="#section-76" class="pilcrow">&#182;</a></div><p>Retrieves the value from a model, but also
checks if this is a function, calling it in that
context if so. Gives priority to function.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">model</span>
                <span class="k">if</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">model</span>
                    <span class="nv">value = </span><span class="nx">model</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
                <span class="k">else</span> <span class="k">if</span> <span class="nx">model</span><span class="p">.</span><span class="nx">has</span><span class="o">?</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
                    <span class="nv">value = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
            <span class="nx">value</span>

        <span class="nv">wrapMethod: </span><span class="nf">(obj, methodName, options = {}) -&gt;</span></pre></div></td></tr><tr id="section-77"><td class="docs"><div class="pilwrap"><a href="#section-77" class="pilcrow">&#182;</a></div><p>Add a before or after hook on a function belonging to a
specified object, preserving its scope (which means it works
even for methods without a fat arrow)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">originalMethod = </span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span></pre></div></td></tr><tr id="section-78"><td class="docs"><div class="pilwrap"><a href="#section-78" class="pilcrow">&#182;</a></div><p>Replace the original method with a wrapper function that
intercepts any calls to the original one and passes them on,
while honoring the given before/after callbacks</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span> <span class="o">=</span> <span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-79"><td class="docs"><div class="pilwrap"><a href="#section-79" class="pilcrow">&#182;</a></div><p>Send the intercepted arguments to the callbacks as well, just
in case we might want to use that information</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">options</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">before</span><span class="p">)</span>
                <span class="nv">returnValue = </span><span class="nx">originalMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">after</span><span class="p">)</span></pre></div></td></tr><tr id="section-80"><td class="docs"><div class="pilwrap"><a href="#section-80" class="pilcrow">&#182;</a></div><p>Restore original method automatically after first call
(it it hasn't been already restored by hand)</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">restore</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">restore</span><span class="p">)</span>
                    <span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">restore</span><span class="p">()</span></pre></div></td></tr><tr id="section-81"><td class="docs"><div class="pilwrap"><a href="#section-81" class="pilcrow">&#182;</a></div><p>Make sure we preserve the return value</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">return</span> <span class="nx">returnValue</span></pre></div></td></tr><tr id="section-82"><td class="docs"><div class="pilwrap"><a href="#section-82" class="pilcrow">&#182;</a></div><p>Create a restore method attached to the wrapped method that
can be called from anywhere, at any time</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nv">restore = </span><span class="nf">-&gt;</span>
                <span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">originalMethod</span></pre></div></td></tr><tr id="section-83"><td class="docs"><div class="pilwrap"><a href="#section-83" class="pilcrow">&#182;</a></div><p>Return the wrapper method</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">methodName</span><span class="p">]</span>

        <span class="nv">inPrintMode: </span><span class="nf">-&gt;</span></pre></div></td></tr><tr id="section-84"><td class="docs"><div class="pilwrap"><a href="#section-84" class="pilcrow">&#182;</a></div><p>Check if app is opened in print mode</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-85"><td class="docs"><div class="pilwrap"><a href="#section-85" class="pilcrow">&#182;</a></div><p>XXX this can be faked easily by adding the ?print=1 GET
parameter, but there's no exploit that can be done by adding it
so there's no reason why we shouldn't rely solely on it</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;print&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="nv">_buildDomElementByWidgetOptions: </span><span class="nf">(options) -&gt;</span></pre></div></td></tr><tr id="section-86"><td class="docs"><div class="pilwrap"><a href="#section-86" class="pilcrow">&#182;</a></div><p>Build DOM element based on the format of widget options
received by the inject method</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">type = </span><span class="nx">options</span><span class="p">.</span><span class="nx">type</span> <span class="o">or</span> <span class="s">&#39;div&#39;</span>
            <span class="nv">id = </span><span class="nx">options</span><span class="p">.</span><span class="nx">id</span>
            <span class="nv">classes = </span><span class="s">&#39;mozaic-widget&#39;</span>
            <span class="nv">classes = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">classes</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">options</span><span class="p">.</span><span class="nx">classes</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">classes</span>
            <span class="nv">data = </span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">or</span> <span class="p">{}</span>
            <span class="nv">data.widget = </span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span>
            <span class="nv">data.params = </span><span class="nx">options</span><span class="p">.</span><span class="nx">params</span> <span class="o">or</span> <span class="p">{}</span>
            <span class="nv">node = </span><span class="nx">@buildDomElement</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">classes</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

        <span class="nv">getControllerContainer: </span><span class="nf">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#controller-container&#39;</span><span class="p">)</span></pre></div></td></tr><tr id="section-87"><td class="docs"><div class="pilwrap"><a href="#section-87" class="pilcrow">&#182;</a></div><p>Extend Utils with other utils functions (see utils/ dir) in order
to keep the same Utils.method() interface.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Utils</span><span class="p">,</span> <span class="nx">Urls</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Utils</span><span class="p">,</span> <span class="nx">Time</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Utils</span><span class="p">,</span> <span class="nx">Dom</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Utils</span><span class="p">,</span> <span class="nx">Images</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Utils</span><span class="p">,</span> <span class="nx">Misc</span><span class="p">)</span>

    <span class="nb">window</span><span class="p">.</span><span class="nv">Utils = </span><span class="nx">Utils</span>
    <span class="k">return</span> <span class="nx">Utils</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:44 GMT+0300 (EEST)  </div></div></body></html>