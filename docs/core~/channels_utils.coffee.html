<!DOCTYPE html><html><head><title>channels_utils.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../core~/channels_utils.coffee.html" class="source selected"><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>channels_utils.coffee</h1><div class="filepath">core~/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[],</span> <span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">channels_utils =</span>

        <span class="nv">splitChannel: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Split a channel name into the 3 components: collection, id, events</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Widgets can declare interest in a channel of the form:
/collection_name/id/events</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><ul>
<li>collection_name is mandatory, and is the name of
the followed entities (e.g., mentions)</li>
<li>id is the ID of the entity followed, or "all" (optional)</li>
<li>/mentions_guid/234 will declare interest in mention with id 234</li>
<li>/mentions_guid/all will declare interest in all mentions
If "id" is missing, it is assumed to be "all"</li>
<li>events is the type of events to be monitored</li>
<li>"all" for all events</li>
<li>"add/remove/reset/change/etc." for a specific event</li>
</ul>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">parts = </span><span class="nx">channel</span><span class="p">[</span><span class="mi">1</span><span class="p">..].</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">3</span>
                <span class="k">return</span> <span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;all&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;all&quot;</span><span class="p">]</span>

        <span class="nv">formChannel: </span><span class="nf">(collection, id, events)-&gt;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Form a channel name given its components.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>This is the exact opposite of splitChannel().</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">collection</span><span class="o">?</span>
                <span class="k">throw</span><span class="p">(</span><span class="s">&#39;A channel key requires at least a collection fragment&#39;</span><span class="p">)</span>
            <span class="nv">keys = </span><span class="p">[</span><span class="nx">collection</span><span class="p">]</span>
            <span class="k">if</span> <span class="nx">id</span><span class="o">?</span>
                <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
                <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="k">if</span> <span class="nx">events</span><span class="o">?</span>
            <span class="k">return</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>

        <span class="nv">translateChannel: </span><span class="nf">(channel, mapping) -&gt;</span>
            <span class="p">[</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">events</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="nv">true_collection = </span><span class="nx">mapping</span><span class="p">[</span><span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">collection</span><span class="p">]</span>
            <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">formChannel</span><span class="p">(</span><span class="nx">true_collection</span><span class="p">[</span><span class="mi">1</span><span class="p">..],</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">events</span><span class="p">)</span>

        <span class="nv">translateChannels: </span><span class="nf">(channels, mapping) -&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Translates the channels using the given mapping.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">result = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">channel</span> <span class="k">in</span> <span class="nx">channels</span>
                <span class="nx">result</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">translateChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">mapping</span><span class="p">)</span>
            <span class="nx">result</span>

        <span class="nv">getChannelKey: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Returns the channel key for a specific channel
(i.e., without the id and events)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nv">widgetMethodForChannel: </span><span class="nf">(widget, channel_key, skip_check = false) -&gt;</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Returns the name of the widget method that is bound
to a given channel's events.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">channel_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span>
                <span class="nv">method_name = </span><span class="s">&#39;get_&#39;</span> <span class="o">+</span> <span class="nx">channel_key</span><span class="p">[</span><span class="mi">1</span><span class="p">..]</span>
            <span class="k">else</span>
                <span class="nv">method_name = </span><span class="s">&#39;get_&#39;</span> <span class="o">+</span> <span class="nx">channel_key</span>

            <span class="k">return</span> <span class="nx">method_name</span>

        <span class="nv">contains_channel: </span><span class="nf">(channel_list, channel) -&gt;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Check if a channel is present in the given channel_list. E.g</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>channels<em>utils.contains</em>channel(
["/social<em>posts/{{id}}", "/social</em>profiles", "/users/{{account_id}}"]
'/users'
)
-> true</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_name = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="nx">ch</span> <span class="k">in</span> <span class="nx">channel_list</span>
                <span class="nv">ch_name = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">ch</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">channel_name</span> <span class="o">==</span> <span class="nx">ch_name</span>
            <span class="kc">false</span>

        <span class="nv">createGlobalChannel: </span><span class="nf">(alias, params, type) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Creates a global channel of the given type with the given params
under the given alias. Global channels will have the "eternal"
flag on - a.k.a. they will never be garbage collected even though
there are no widgets subscribed to them.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>The channel<em>alias -> channel</em>id mapping should be stored
in the Mozaic global object.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>The result of the function is the channel id of the newly created
channel because we might need to use it right away.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>@param{string} alias - name under which the global channel will
be known from now on
@param{Object} params - parameters for the channel initialization
(defaults to empty dict)
@param{string} type - the type of channel (e.g. /social_profiles).
Defaults to the alias in order to encourage
intuitive naming of global aliases.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>@return{string} - the globally unique ID of the channel, if we
managed to create it, or null, if something went
wrong.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>By default, type is not specified, alias is the type of channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">type = </span><span class="nx">type</span> <span class="o">or</span> <span class="nx">alias</span>
            <span class="nv">params = </span><span class="nx">params</span> <span class="o">or</span> <span class="p">{}</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Make sure that Mozaic.global_channels key exists</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">Mozaic.globalChannels = </span><span class="nx">Mozaic</span><span class="p">.</span><span class="nx">globalChannels</span> <span class="o">or</span> <span class="p">{}</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Prevent double creation of the same global channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">alias</span> <span class="k">of</span> <span class="nx">Mozaic</span><span class="p">.</span><span class="nx">globalChannels</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Trying to create global channel for already &quot;</span> <span class="o">+</span>
                             <span class="s">&quot;existing alias: </span><span class="si">#{</span><span class="nx">alias</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">null</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Create a new channel, and store the uid in the global mapping</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_params = </span><span class="p">{}</span>
            <span class="nx">channel_params</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">params</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;__eternal__&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
            <span class="p">[</span><span class="nx">channel_uid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">newDataChannels</span><span class="p">(</span><span class="nx">channel_params</span><span class="p">)</span>
            <span class="nx">Mozaic</span><span class="p">.</span><span class="nx">globalChannels</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channel_uid</span>

            <span class="k">return</span> <span class="nx">channel_uid</span>

        <span class="nv">getGlobalChannel: </span><span class="nf">(alias) -&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Given an alias, retrieve the unique identifier of the channel
found under that alias.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>@param{string} alias - the alias name of the channel</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>@return{string} - the unique identifier of the channel with
the given alias</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channels = </span><span class="nx">Mozaic</span><span class="p">.</span><span class="nx">globalChannels</span> <span class="o">or</span> <span class="p">{}</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Sanity check for retrieving an unknown global channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">alias</span> <span class="k">of</span> <span class="nx">channels</span><span class="p">)</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Trying to retrieve inexisting &quot;</span> <span class="o">+</span>
                             <span class="s">&quot;global channel: </span><span class="si">#{</span><span class="nx">alias</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">null</span>

            <span class="k">return</span> <span class="nx">Mozaic</span><span class="p">.</span><span class="nx">globalChannels</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span>

        <span class="nv">isGlobal: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Returns true iff a channel is global.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>@param{string} channel - a channel name</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>@return{Boolean} true iff the channel is a reference to a
global channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="s">&#39;GLOBAL/&#39;</span><span class="p">)</span>

        <span class="nv">removeGlobalPrefix: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Removes the 'GLOBAL' prefix from a given channel.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>@param{string} channel - a channel which is known to be a
reference to a global channel
@return{string} the channel with the global prefix stripped</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">channel</span><span class="p">[</span><span class="s">&#39;GLOBAL&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">..]</span>

        <span class="nv">translateGlobalChannel: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Given a global channel of the form:</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>GLOBAL/social_profiles</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>extract the name of the alias from the channel and translate
it into the actual channel id of that alias.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>@param{string} channel - a channel which is known to be a
reference to a global channel
@return{string} the translated channel, using the channel uid
of the alias from the global mapping,
if available</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Nothing to translate, it's not a global channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">isGlobal</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
                <span class="k">return</span> <span class="nx">channel</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>Remove the 'GLOBAL' prefix and then use the translateChannel
api with a mapping containing a single element.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_without_prefix = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">removeGlobalPrefix</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>Split the channel into its components, and perform translation</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_key = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">channel_without_prefix</span><span class="p">)</span>
            <span class="nv">channel_uid = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getGlobalChannel</span><span class="p">(</span><span class="nx">channel_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">channel_uid</span>
                <span class="k">return</span> <span class="kc">null</span>

            <span class="k">return</span> <span class="nx">channel_uid</span>

        <span class="nv">translateGlobalChannels: </span><span class="nf">(channel_mapping) -&gt;</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>Translate a bunch of global channels given in the format
of widget.channel_mapping.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>@param{dict} channel_mapping - a dictionary from channel to
channel guid (or reference to
global channel)
@return{dict} a new dictionary with the mapping from the
channel names to the real channel uids</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">result = </span><span class="p">{}</span>

            <span class="k">for</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">channel_guid</span> <span class="k">of</span> <span class="nx">channel_mapping</span>
                <span class="k">if</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">isGlobal</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">)</span>
                    <span class="nv">channel_guid = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">translateGlobalChannel</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">)</span>
                <span class="nx">result</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channel_guid</span>

            <span class="k">return</span> <span class="nx">result</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:34 GMT+0300 (EEST)  </div></div></body></html>