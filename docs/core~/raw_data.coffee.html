<!DOCTYPE html><html><head><title>raw_data.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../core~/raw_data.coffee.html" class="source selected"><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>raw_data.coffee</h1><div class="filepath">core~/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[],</span> <span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="k">class</span> <span class="nx">RawData</span>
        <span class="nv">collection_type: </span><span class="s">&#39;api&#39;</span>

        <span class="nv">constructor: </span><span class="nf">-&gt;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span>
            <span class="vi">@data = </span><span class="p">{}</span>
            <span class="vi">@default_value = </span><span class="p">{}</span>

        <span class="nv">setDefaultValue: </span><span class="nf">(default_value) =&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Sets the default values for this RawData.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>default: a dictionary of the form k, v, where k is the
key name, and v can be either a value or a function
Returns: nothing</p>
</td><td class="code"><div class="highlight"><pre>            <span class="vi">@default_value = </span><span class="p">{}</span>
            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">default_value</span>
                <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
                    <span class="nx">@default_value</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">()</span>
                <span class="k">else</span>
                    <span class="nx">@default_value</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>

        <span class="nv">getData: </span><span class="nf">(return_default_data = true) =&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Get the value of data. If return<em>default</em>data is false we ignore
the default values. An use-case is the date-filter.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">result = </span><span class="k">if</span> <span class="nx">return_default_data</span> <span class="k">then</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@default_value</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">@data</span><span class="p">)</span>

        <span class="nv">toJSON: </span><span class="o">=&gt;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@data</span><span class="p">)</span>

        <span class="nv">get: </span><span class="nf">(key) =&gt;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Returns: the data at the given path or null</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>For example, if we want to get the available languages from an
analytics call, we can do data.get('available/languages'). This
is somewhat similar to XPath.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">getNestedAttr</span><span class="p">(</span><span class="nx">@getData</span><span class="p">(),</span> <span class="nx">key</span><span class="p">)</span>

        <span class="nv">has: </span><span class="nf">(key) =&gt;</span>
            <span class="k">return</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">@getData</span><span class="p">())</span>

        <span class="nv">set: </span><span class="nf">(k, v = null, options = {}) =&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Check it's called with the dict syntax</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
                <span class="nv">dict = </span><span class="nx">k</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>.. or with the single-key-and-value syntax</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span>
                <span class="nv">dict = </span><span class="p">{}</span>
                <span class="nx">dict</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
            <span class="nx">@_internal_set</span><span class="p">(</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

            <span class="k">return</span> <span class="k">this</span>

        <span class="nv">_internal_set: </span><span class="nf">(dict, options) =&gt;</span>
            <span class="nv">previousData = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@data</span><span class="p">)</span>

            <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reset</span> <span class="o">or</span> <span class="nx">options</span><span class="p">.</span><span class="nx">new_data</span>
                <span class="vi">@data = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Alter the internal data</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">dict</span>
                <span class="nx">@data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>

            <span class="nv">changed_attributes = </span><span class="nx">@_getChanged</span><span class="p">(</span><span class="nx">previousData</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Before triggering reset/change events
we need to handle datasource logic when fetching channel data
like setting last_fetch timestamp
Fetched event hook was also defined in backbone collection</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">options</span><span class="p">.</span><span class="nx">fetched</span><span class="p">()</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fetched</span><span class="o">?</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Trigger the change event - only once</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">silent</span> <span class="o">!=</span> <span class="kc">true</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>If this was a complete reset of the RawData,
trigger the reset event</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reset</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>The changed attributes are ALL the attributes in this
case, but it might be OK to have a consistent signature,
but also, since the events are async, it might be helpful
to know these attributes in the event callback since the
model could already have been altered at that point</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">changed_attributes</span><span class="p">)</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Otherwise, trigger the change event.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span>
                    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">changed_attributes</span><span class="p">)</span>

        <span class="nv">unset: </span><span class="nf">(dict, options={}) =&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>unset an attribute</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">previousData = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">@data</span><span class="p">)</span>

            <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">dict</span>
                <span class="k">if</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">@data</span>
                    <span class="k">delete</span> <span class="nx">@data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>

            <span class="nv">changed_attributes = </span><span class="nx">@_getChanged</span><span class="p">(</span><span class="nx">previousData</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">silent</span> <span class="o">!=</span> <span class="kc">true</span><span class="p">)</span>
                <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">changed_attributes</span><span class="p">)</span>

            <span class="k">return</span> <span class="k">this</span>

        <span class="nv">fetch: </span><span class="nf">(options = {}) =&gt;</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Fetches the data for this channel from a given URL.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>url: the url to fetch from (it should return JSON)
options:
add: true - overwrite the current collections with a new one
(items with non-overlapping keys will be kept). Default
is to "reset" the collection (a.k.a. replace it
completely with the new one).
Returns: nothing</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Check that we know where to fetch the data from</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="s">&#39;url&#39;</span> <span class="k">of</span> <span class="nx">@</span><span class="p">)</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Can&#39;t fetch RawData from non-existing URL&quot;</span><span class="p">)</span>
                <span class="k">return</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Determine HTTP GET params</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="k">of</span> <span class="nx">options</span>
                <span class="nv">params = </span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span>
            <span class="k">else</span>
                <span class="nv">params = </span><span class="p">{}</span>

            <span class="nv">success_callback = </span><span class="nf">(data, response_status) =&gt;</span>
                <span class="k">if</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">add</span><span class="o">?</span>
                    <span class="vi">@data = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Make sure that data is always a dict, even when
we're getting a raw text response</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="o">not</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
                    <span class="nv">data = </span><span class="p">{</span><span class="nv">result: </span><span class="nx">data</span><span class="p">}</span>

                <span class="nx">@set</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="nv">new_data: </span><span class="kc">true</span><span class="p">,</span> <span class="nv">fetched: </span><span class="nx">options</span><span class="p">.</span><span class="nx">fetched</span><span class="p">})</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Trigger a sync event (similar to Backbone's sync event)</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;sync&#39;</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Also call the success callback.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">response_status</span><span class="p">)</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Trigger a no_data event when the response is empty</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
                    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;no_data&#39;</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>

            <span class="nv">error_callback = </span><span class="nf">(xhr, response_status, error_string) =&gt;</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Trigger an 'error' event when the request results in an error
(including 3xx redirect and excluding 304 timeout)
This is important because we need to have a response from
widgets on error events.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Make the actual AJAX request</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">call_params =</span>
                <span class="nv">url: </span><span class="nx">@url</span>
                <span class="nv">dataType: </span><span class="s">&#39;json&#39;</span>
                <span class="nv">data: </span><span class="nx">params</span>
                <span class="nv">success: </span><span class="nx">success_callback</span>
                <span class="nv">error: </span><span class="nx">error_callback</span>
                <span class="nv">type: </span><span class="nx">options</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="s">&#39;GET&#39;</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>If we are passed contentType, pass it through</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contentType</span>
                <span class="nv">call_params.contentType = </span><span class="nx">options</span><span class="p">.</span><span class="nx">contentType</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">call_params</span><span class="p">)</span>

        <span class="nv">_getChanged: </span><span class="nf">(previousData) -&gt;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Compare a previous set of data and establish the changed
attributes between the two</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">changed = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Get the union of all attribute keys from both the previous and
the current data set</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">_</span><span class="p">.</span><span class="nx">union</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">previousData</span><span class="p">),</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">@data</span><span class="p">))</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Only mark attributes with different values as changed</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">changed</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="k">if</span> <span class="nx">@data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">previousData</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
            <span class="k">return</span> <span class="nx">changed</span>

    <span class="k">return</span> <span class="nx">RawData</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:42 GMT+0300 (EEST)  </div></div></body></html>