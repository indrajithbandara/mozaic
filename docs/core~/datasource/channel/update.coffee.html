<!DOCTYPE html><html><head><title>update.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../../core~/datasource/channel/update.coffee.html" class="source selected"><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>update.coffee</h1><div class="filepath">core~/datasource/channel/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!channels_utils&#39;</span><span class="p">],</span> <span class="nf">(channels_utils) -&gt;</span>

    <span class="k">class</span> <span class="nx">DataSourceChannelUpdateMixin</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Includes methods to update data for a datasource channel and
sync it with the server</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">modifyDataChannel: </span><span class="nf">(channel, dict, options = {}) -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Modifies the data found at channel by calling
data.set(k, v) for each pair (k, v) of dict.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>@param {String}     channel                 The channel on which to modify objects
@param {Object}     dict                    The dictionary of changes to be made
@param {Object}     options
@param {String}     [options.update_mode]   The update mode for this item. Possible values: 'append', 'reset', 'exclude'
@param {Boolean}    [options.sync]          Determine whether we should sync the data with the server
@param {Boolean}    [options.silent]        Determine whether we should silently update the model or not
@param {Object}     [options.filter]        Filter the objects to be modified</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Modifying data from </span><span class="si">#{</span><span class="nx">channel</span><span class="si">}</span><span class="s"> in DataSource&quot;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Split the channel into its components and get the "id" part.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">item = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nv">channel_guid = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>

            <span class="k">unless</span> <span class="nx">@reference_data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">]</span><span class="o">?</span>
                <span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t modify data from channel </span><span class="si">#{</span><span class="nx">channel_guid</span><span class="si">}</span><span class="s"> &quot;</span> <span class="o">+</span>
                            <span class="s">&quot;because it was already removed&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="nv">resource_type = </span><span class="nx">@_getType</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">resource_type</span> <span class="o">==</span> <span class="s">&#39;relational&#39;</span>
                <span class="k">if</span> <span class="nx">item</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Modifying the whole collection is not supported for Backbone collections
Exception is made when a filter is passed in options</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">filter</span><span class="o">?</span> <span class="o">or</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span>
                        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Modifying the whole collection is not supported for</span>
<span class="s">                                  relational collections&quot;</span><span class="p">)</span>
                        <span class="k">return</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Modify the channel_guid that we received the /modify on, doing sync only
for this one, if sync = true...</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@_findAndModifyRelationalChannelModel</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>... Then go through all other channels and update
those of the same type with channel_guid containing the item.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">channel_type = </span><span class="nx">@meta_data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">].</span><span class="nx">type</span>
                <span class="k">for</span> <span class="nx">other_channel_guid</span><span class="p">,</span> <span class="nx">other_channel_data</span> <span class="k">of</span> <span class="nx">@meta_data</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Skip the original channel, we've already modified this one.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">continue</span> <span class="k">if</span> <span class="nx">channel_guid</span> <span class="o">==</span> <span class="nx">other_channel_guid</span>
                    <span class="k">if</span> <span class="nx">other_channel_data</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">channel_type</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Don't sync with server, we already sync'ed above.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">@_findAndModifyRelationalChannelModel</span><span class="p">(</span><span class="nx">other_channel_guid</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span><span class="nv">sync: </span><span class="kc">false</span><span class="p">}))</span>

            <span class="k">else</span> <span class="k">if</span> <span class="nx">resource_type</span> <span class="o">==</span> <span class="s">&#39;api&#39;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>For raw data channels, we don't support individual model modifications.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">item</span> <span class="o">!=</span> <span class="s">&quot;all&quot;</span>
                    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Modifying individual items is not supported for</span>
<span class="s">                                  raw collections&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="nx">@_modifyApiDataChannel</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">update_mode</span><span class="p">)</span>

        <span class="nv">_modifyApiDataChannel: </span><span class="nf">(channel_guid, dict, update_mode) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Implementation of modifyDataChannel specific for api channels.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">model = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">]</span>
            <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;append&#39;</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;reset&#39;</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">dict</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="nv">reset: </span><span class="kc">true</span><span class="p">})</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;exclude&#39;</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span>

        <span class="nv">_findAndModifyRelationalChannelModel: </span><span class="nf">(channel_guid, item, dict, options = {}) -&gt;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Implementation of modifyDataChannel specific for relational channels.
We want to update (append, reset or exclude) attributes of a
model which is a part of a collection. We perform an implicit save
after we update the attributes. Because the save might fail we don't
want to trigger any change events on the collection/model before knowing
the new attributes are valid. We clone the individual model and
perform the update and then the save on the clone.
After the save is successful (only if we have to sync with the server)
in the success callback we set the new attributes again and
we let the change events propagate on the collection</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span><span class="nv">sync: </span><span class="kc">true</span><span class="p">,</span> <span class="nv">silent: </span><span class="kc">false</span><span class="p">,</span> <span class="nv">filter: </span><span class="p">{}})</span>
            <span class="nv">collection = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">]</span>

            <span class="nv">filtered_models = </span><span class="k">if</span> <span class="nx">item</span> <span class="o">is</span> <span class="s">&#39;all&#39;</span> <span class="k">then</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">filter_by</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">)]</span>

            <span class="k">for</span> <span class="nx">individual_model</span> <span class="k">in</span> <span class="nx">filtered_models</span>
                <span class="nx">@_findAndModifyCollectionModel</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">individual_model</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="k">if</span> <span class="nx">individual_model</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Also look for item in buffer, and modify it if it exists.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@_getBufferSize</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">)</span>
                <span class="nv">filtered_models_in_buffer = </span><span class="k">if</span> <span class="nx">item</span> <span class="o">is</span> <span class="s">&#39;all&#39;</span> <span class="k">then</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">filter_by</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="nx">collection</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">)]</span>
                <span class="k">for</span> <span class="nx">individual_model</span> <span class="k">in</span> <span class="nx">filtered_models_in_buffer</span>
                    <span class="nx">@_findAndModifyCollectionModel</span><span class="p">(</span><span class="nx">collection</span><span class="p">.</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">individual_model</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">{</span><span class="nv">sync: </span><span class="kc">false</span><span class="p">}))</span> <span class="k">if</span> <span class="nx">individual_model</span>

        <span class="nv">_findAndModifyCollectionModel: </span><span class="nf">(collection, individual_model, dict, options) -&gt;</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Modifies the individual_model passed in arguments.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">[</span><span class="nx">update_mode</span><span class="p">,</span> <span class="nx">sync</span><span class="p">,</span> <span class="nx">silent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">update_mode</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sync</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">silent</span><span class="p">]</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Clone the individual model and set it's urlRoot property
because the clone won't be part of the collection. This way
we have a proper model url</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">cloned_model = </span><span class="nx">individual_model</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
            <span class="nv">cloned_model.urlRoot = </span><span class="nx">collection</span><span class="p">.</span><span class="nx">url</span>
            <span class="nv">cloned_model.collection = </span><span class="nx">collection</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Perform a save on the model and propagate any error events
received from the server on the model's channel. If the
save is successful update the collection's model (individual_model)
with the new values of the clone (this will trigger the change events
after the save is ok). Otherwise trigger the errors on the individual
model</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">sync</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Update clone without triggering any change events (won't matter
though because the clone is not part of a collection)</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">cloned_model = </span><span class="nx">@_updateRelationModel</span><span class="p">(</span><span class="nx">cloned_model</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">update_mode</span><span class="p">)</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Trigger a custom invalidate event before the
model is saved to the server. Backbone.Model emits
a sync event if the save was successful. The invalidate
event has the following signature:
'invalidate', model, collection</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">individual_model</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;invalidate&#39;</span><span class="p">,</span> <span class="nx">individual_model</span><span class="p">,</span> <span class="nx">collection</span><span class="p">)</span>
                <span class="nv">options =</span>
                    <span class="nv">error: </span><span class="nf">(model, response, options) =&gt;</span>
                        <span class="nx">individual_model</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
                    <span class="nv">success: </span><span class="nf">(model, response) =&gt;</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Update model with attributes to sync from response.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">@syncModelWithResponse</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
                        <span class="nv">options = </span><span class="p">{</span><span class="s">&#39;silent&#39;</span><span class="o">:</span> <span class="nx">silent</span><span class="p">}</span>
                        <span class="nx">individual_model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Note: passing silent = true to this will only cause
the cloned model to be updated silently, which doesn't
matter anyway, because no widget ever knows about it.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">cloned_model</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">cloned_model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
            <span class="k">else</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>TODO: For consistency should we trigger invalidate here as well?
If we don't need to sync with the server we can just update
the model reference in the collection and now trigger
the change events</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@_updateRelationModel</span><span class="p">(</span><span class="nx">individual_model</span><span class="p">,</span> <span class="nx">dict</span><span class="p">,</span> <span class="nx">update_mode</span><span class="p">,</span> <span class="nx">silent</span><span class="p">)</span>

        <span class="nv">_updateRelationModel: </span><span class="nf">(model, dict, update_mode, silent = true) -&gt;</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Update a provided model with the dict arguments bypassing
events triggering using the silent argument.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">silence = </span><span class="p">{</span> <span class="nv">silent: </span><span class="nx">silent</span> <span class="p">}</span>
            <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;append&#39;</span>
                <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">dict</span>
                    <span class="nv">currentValue = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>If the attribute of the model is an array and the value
set not, push it into that array instead of overwritting</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">currentValue</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Get current value first</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nv">value = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">currentValue</span><span class="p">)</span>
                        <span class="nx">value</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
                    <span class="k">else</span>
                        <span class="nv">value = </span><span class="nx">v</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">silence</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;reset&#39;</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">silent</span><span class="p">)</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">dict</span><span class="p">,</span> <span class="nx">silence</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">update_mode</span> <span class="o">==</span> <span class="s">&#39;exclude&#39;</span>
                <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">dict</span>
                    <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
                        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Trying to unset a dictionary instead of a key&quot;</span><span class="p">)</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">silence</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">model</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:36 GMT+0300 (EEST)  </div></div></body></html>