<!DOCTYPE html><html><head><title>channel.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source selected"><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>channel.coffee</h1><div class="filepath">core~/datasource/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!channels_utils&#39;</span><span class="p">],</span> <span class="nf">(channels_utils) -&gt;</span>

    <span class="k">class</span> <span class="nx">DataSourceChannelMixin</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Include methods to initialize a data channel. It will become
a class ...</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">_initRelationalChannel: </span><span class="nf">(name, type, params) -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Initialize a relational channel.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>A relational channel is backed by a Backbone collection. This
will dynamically load the collection class via require.js,
create an instance of the collection class and perform
final channel initialization logic.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Load the collection class via require.js</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">collection_name = </span><span class="nx">@config</span><span class="p">.</span><span class="nx">channel_types</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">collection</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Allow using base_collection as a default</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">collection_name</span><span class="o">?</span>
                <span class="nv">collection_module = </span><span class="s">&quot;cs!collection/</span><span class="si">#{</span><span class="nx">collection_name</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="k">else</span>
                <span class="nv">collection_module = </span><span class="s">&quot;cs!base_collection&quot;</span>

            <span class="nx">require</span> <span class="p">[</span><span class="nx">collection_module</span><span class="p">],</span> <span class="nf">(collection_class) =&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Stop with the channel initialization if the reference data
for this channel was removed in the meantime</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">return</span> <span class="k">unless</span> <span class="nx">@reference_data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span>

                <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">collection_class</span><span class="p">()</span>
                <span class="nv">conf = </span><span class="nx">@config</span><span class="p">.</span><span class="nx">channel_types</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span>
                <span class="nv">eternal = </span><span class="nx">params</span><span class="p">[</span><span class="s">&#39;__eternal__&#39;</span><span class="p">]</span><span class="o">?</span>
                <span class="k">delete</span> <span class="nx">params</span><span class="p">[</span><span class="s">&#39;__eternal__&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nx">eternal</span>
                <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span>
                    <span class="nv">type: </span><span class="nx">type</span>
                    <span class="nv">params: </span><span class="nx">params</span>
                    <span class="nv">eternal: </span><span class="nx">eternal</span>
                    <span class="nv">collection_class: </span><span class="nx">collection_class</span>
                    <span class="nv">model_class: </span><span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">model</span>
                <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nv">populate_on_init = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">populate_on_init</span> <span class="o">or</span> <span class="nx">params</span><span class="p">.</span><span class="nx">populate_on_init</span>

                <span class="k">if</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">populate_on_init</span> <span class="o">and</span> <span class="nx">params</span><span class="p">.</span><span class="nx">_initial_data_</span>
                    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">populate_on_init</span><span class="o">?</span>
                        <span class="k">delete</span> <span class="nx">params</span><span class="p">[</span><span class="s">&#39;populate_on_init&#39;</span><span class="p">]</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Avoid creating empty models</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">_initial_data_</span><span class="p">)</span>
                        <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">_initial_data_</span><span class="p">)</span>
                    <span class="k">delete</span> <span class="nx">params</span><span class="p">.</span><span class="nx">_initial_data_</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>The url of a collection is set after fetching server
data, but for collections with initial data the fetch
branch is not executed. Set the url here.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nv">default_value = </span><span class="nx">@_getDefaultParams</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
                    <span class="nv">url_params = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">default_value</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="o">?</span>
                        <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nv">url = </span><span class="nx">Utils</span><span class="p">.</span><span class="nx">render_url</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">url_params</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Initialize buffer.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">buffer_size</span><span class="o">?</span> <span class="o">and</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">buffer_size</span>
                    <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nv">buffer = </span><span class="k">new</span> <span class="nx">collection_class</span><span class="p">()</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Give access to the collection from the buffer</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nv">buffer.collection = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
                <span class="nx">@_finishChannelInitialization</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>

        <span class="nv">_initApiChannel: </span><span class="nf">(name, type, params) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Initialize an API channel.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>This will only create a raw data object instantly and perform
final channel initialization logic.
Load the collection class via require.js</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">collection_name = </span><span class="nx">@config</span><span class="p">.</span><span class="nx">channel_types</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">collection</span> <span class="o">or</span> <span class="s">&#39;raw_data&#39;</span>
            <span class="nv">collection_module = </span><span class="s">&quot;cs!collection/&quot;</span> <span class="o">+</span> <span class="nx">collection_name</span>

            <span class="nx">require</span> <span class="p">[</span><span class="nx">collection_module</span><span class="p">],</span> <span class="nf">(collection_class) =&gt;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Stop with the channel initialization if the reference data
for this channel was removed in the meantime</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">return</span> <span class="k">unless</span> <span class="nx">@reference_data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span>

                <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">collection_class</span><span class="p">()</span>
                <span class="nv">conf = </span><span class="nx">@config</span><span class="p">.</span><span class="nx">channel_types</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span>
                <span class="nv">eternal = </span><span class="nx">params</span><span class="p">[</span><span class="s">&#39;__eternal__&#39;</span><span class="p">]</span><span class="o">?</span>
                <span class="k">delete</span> <span class="nx">params</span><span class="p">[</span><span class="s">&#39;__eternal__&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nx">eternal</span>
                <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span>
                    <span class="nv">type: </span><span class="nx">type</span>
                    <span class="nv">params: </span><span class="nx">params</span>
                    <span class="nv">eternal: </span><span class="nx">eternal</span>
                    <span class="nv">collection_class: </span><span class="nx">collection_class</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>If there is a default value for this channel, set it.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="s">&#39;default_value&#39;</span> <span class="k">of</span> <span class="nx">conf</span>
                    <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">setDefaultValue</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">default_value</span><span class="p">)</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>If the populate<em>on</em>init flag is set for this channel, then
the parameters sent when creating the channel serve as initial values.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nv">populate_on_init = </span><span class="nx">conf</span><span class="p">.</span><span class="nx">populate_on_init</span> <span class="o">or</span> <span class="nx">params</span><span class="p">.</span><span class="nx">populate_on_init</span>
                <span class="k">if</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">populate_on_init</span>
                    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">populate_on_init</span><span class="o">?</span>
                        <span class="k">delete</span> <span class="nx">params</span><span class="p">[</span><span class="s">&#39;populate_on_init&#39;</span><span class="p">]</span>
                    <span class="nx">@data</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">set</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
                <span class="nx">@_finishChannelInitialization</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>

        <span class="nv">_getConfig: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Returns the configuration for a given channel.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Get the channel key. This is where the actual data is in @data</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_key = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Use @meta_data to find out the actual type of this channel</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_type = </span><span class="nx">@meta_data</span><span class="p">[</span><span class="nx">channel_key</span><span class="p">].</span><span class="nx">type</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Finally, retrieve channel type configuration</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@config</span><span class="p">.</span><span class="nx">channel_types</span><span class="p">[</span><span class="nx">channel_type</span><span class="p">]</span>

        <span class="nv">_getType: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Returns the channel type: relational / api / etc.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@_getConfig</span><span class="p">(</span><span class="nx">channel</span><span class="p">).</span><span class="nx">type</span>

        <span class="nv">_getDefaultParams: </span><span class="nf">(channel) -&gt;</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Returns the default HTTP params for a given channel.
This feature is only supported by relational channels for now.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>For API channels, the default_value has a completely different
meaning: the default value of the JSON data.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>TODO(andrei): refactor this to be less dumb</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">type = </span><span class="nx">@_getType</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>We only support HTTP params for channels of type relational</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">type</span> <span class="o">!=</span> <span class="s">&#39;relational&#39;</span>
                <span class="k">return</span> <span class="p">{}</span>
            <span class="nv">conf = </span><span class="nx">@_getConfig</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="nx">conf</span><span class="p">.</span><span class="nx">default_value</span> <span class="o">or</span> <span class="p">{}</span>

        <span class="nv">_cloneChannel: </span><span class="nf">(channel_guid, source_channel_guid) -&gt;</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>Clones the source channel to channel_guid.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Cloning </span><span class="si">#{</span><span class="nx">channel_guid</span><span class="si">}</span><span class="s"> from </span><span class="si">#{</span><span class="nx">source_channel_guid</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">].</span><span class="nv">cloned_from = </span><span class="nx">source_channel_guid</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Mark the new clone as having been recently fetched.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">].</span><span class="nv">last_fetch = </span><span class="nx">@meta_data</span><span class="p">[</span><span class="nx">source_channel_guid</span><span class="p">].</span><span class="nx">last_fetch</span>
            <span class="nv">dest = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">channel_guid</span><span class="p">]</span>
            <span class="nv">source = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">source_channel_guid</span><span class="p">]</span>
            <span class="nv">channel_type = </span><span class="nx">@_getType</span><span class="p">(</span><span class="nx">channel_guid</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">channel_type</span> <span class="o">==</span> <span class="s">&#39;relational&#39;</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>Clone model without triggering any events.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">silence = </span><span class="p">{</span> <span class="nv">silent: </span><span class="kc">true</span> <span class="p">}</span>
                <span class="k">for</span> <span class="nx">model</span> <span class="k">in</span> <span class="nx">source</span><span class="p">.</span><span class="nx">models</span>
                    <span class="nx">dest</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span> <span class="nx">silence</span><span class="p">)</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Trigger the golden news</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">dest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>Clone buffer</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="s">&#39;buffer&#39;</span> <span class="k">of</span> <span class="nx">source</span>
                    <span class="k">for</span> <span class="nx">model</span> <span class="k">in</span> <span class="nx">source</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">models</span>
                        <span class="nx">dest</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span> <span class="nx">silence</span><span class="p">)</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Clone url property</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="s">&#39;url&#39;</span> <span class="k">of</span> <span class="nx">source</span>
                    <span class="nv">dest.url = </span><span class="nx">source</span><span class="p">.</span><span class="nx">url</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">channel_type</span> <span class="o">==</span> <span class="s">&#39;api&#39;</span>
                <span class="nx">dest</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:37 GMT+0300 (EEST)  </div></div></body></html>