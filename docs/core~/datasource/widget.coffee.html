<!DOCTYPE html><html><head><title>widget.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../core~/api_mock.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">api_mock.coffee</span></a><a href="../../core~/application_controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">application_controller.coffee</span></a><a href="../../core~/auth.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">auth.coffee</span></a><a href="../../core~/base_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_collection.coffee</span></a><a href="../../core~/base_model.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">base_model.coffee</span></a><a href="../../core~/base_widgets/autocomplete.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">autocomplete.coffee</span></a><a href="../../core~/base_widgets/base_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">base_form.coffee</span></a><a href="../../core~/base_widgets/delete_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">delete_form.coffee</span></a><a href="../../core~/base_widgets/expanding_list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">expanding_list.coffee</span></a><a href="../../core~/base_widgets/item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">item_count.coffee</span></a><a href="../../core~/base_widgets/list.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">list.coffee</span></a><a href="../../core~/base_widgets/mediator_widget.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">mediator_widget.coffee</span></a><a href="../../core~/base_widgets/nested_attributes_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">nested_attributes_form.coffee</span></a><a href="../../core~/base_widgets/new_items_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">new_items_count.coffee</span></a><a href="../../core~/base_widgets/notification_bar.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notification_bar.coffee</span></a><a href="../../core~/base_widgets/notifications.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">notifications.coffee</span></a><a href="../../core~/base_widgets/order_by.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">order_by.coffee</span></a><a href="../../core~/base_widgets/update_form.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">update_form.coffee</span></a><a href="../../core~/base_widgets/url.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">url.coffee</span></a><a href="../../core~/base_widgets/user_item_count.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">user_item_count.coffee</span></a><a href="../../core~/base_widgets/widget_editor.coffee.html" class="source "><span class="base_path">core~ / base_widgets / </span><span class="file_name">widget_editor.coffee</span></a><a href="../../core~/channels_utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">channels_utils.coffee</span></a><a href="../../core~/constants.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">constants.coffee</span></a><a href="../../core~/context_processors.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">context_processors.coffee</span></a><a href="../../core~/controller.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">controller.coffee</span></a><a href="../../core~/core_modules.js.html" class="source "><span class="base_path">core~ / </span><span class="file_name">core_modules.js</span></a><a href="../../core~/datasource/channel/create.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">create.coffee</span></a><a href="../../core~/datasource/channel/destroy.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">destroy.coffee</span></a><a href="../../core~/datasource/channel/read.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">read.coffee</span></a><a href="../../core~/datasource/channel/update.coffee.html" class="source "><span class="base_path">core~ / datasource / channel / </span><span class="file_name">update.coffee</span></a><a href="../../core~/datasource/channel.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">channel.coffee</span></a><a href="../../core~/datasource/datasource.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">datasource.coffee</span></a><a href="../../core~/datasource/gc.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">gc.coffee</span></a><a href="../../core~/datasource/refresher.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">refresher.coffee</span></a><a href="../../core~/datasource/scheduler.coffee.html" class="source "><span class="base_path">core~ / datasource / </span><span class="file_name">scheduler.coffee</span></a><a href="../../core~/datasource/widget.coffee.html" class="source selected"><span class="base_path">core~ / datasource / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/flags_collection.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">flags_collection.coffee</span></a><a href="../../core~/interceptor.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">interceptor.coffee</span></a><a href="../../core~/layout.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">layout.coffee</span></a><a href="../../core~/loader.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loader.coffee</span></a><a href="../../core~/loading_animation.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">loading_animation.coffee</span></a><a href="../../core~/logging/sentry_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">sentry_logger.coffee</span></a><a href="../../core~/logging/standard_logger.coffee.html" class="source "><span class="base_path">core~ / logging / </span><span class="file_name">standard_logger.coffee</span></a><a href="../../core~/mocks.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mocks.coffee</span></a><a href="../../core~/modal_window.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">modal_window.coffee</span></a><a href="../../core~/module.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">module.coffee</span></a><a href="../../core~/mozaic_backbone_form.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">mozaic_backbone_form.coffee</span></a><a href="../../core~/profiler.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">profiler.coffee</span></a><a href="../../core~/pubsub.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">pubsub.coffee</span></a><a href="../../core~/raw_data.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">raw_data.coffee</span></a><a href="../../core~/router.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">router.coffee</span></a><a href="../../core~/scrollable_widget.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">scrollable_widget.coffee</span></a><a href="../../core~/utils/dom.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">dom.coffee</span></a><a href="../../core~/utils/images.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">images.coffee</span></a><a href="../../core~/utils/misc.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">misc.coffee</span></a><a href="../../core~/utils/mozaic.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">mozaic.coffee</span></a><a href="../../core~/utils/time.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">time.coffee</span></a><a href="../../core~/utils/urls.coffee.html" class="source "><span class="base_path">core~ / utils / </span><span class="file_name">urls.coffee</span></a><a href="../../core~/utils.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">utils.coffee</span></a><a href="../../core~/widget/aggregated_channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">aggregated_channels.coffee</span></a><a href="../../core~/widget/backbone_events.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">backbone_events.coffee</span></a><a href="../../core~/widget/channels.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">channels.coffee</span></a><a href="../../core~/widget/modal_widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">modal_widget.coffee</span></a><a href="../../core~/widget/params.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">params.coffee</span></a><a href="../../core~/widget/rendering.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">rendering.coffee</span></a><a href="../../core~/widget/states.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">states.coffee</span></a><a href="../../core~/widget/widget.coffee.html" class="source "><span class="base_path">core~ / widget / </span><span class="file_name">widget.coffee</span></a><a href="../../core~/widget_starter.coffee.html" class="source "><span class="base_path">core~ / </span><span class="file_name">widget_starter.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>widget.coffee</h1><div class="filepath">core~/datasource/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;cs!channels_utils&#39;</span><span class="p">],</span> <span class="nf">(channels_utils) -&gt;</span>

    <span class="k">class</span> <span class="nx">DataSourceWidgetMixin</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Includes methods for widgets to subscribe to data channels and
new and delete methods once widgets "connect to data"</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">newWidget: </span><span class="nf">(widget_data) -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>This gets called whenever a new widget announces its existence.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>It determines which data from the data source is "interesting"
for the widget and subscribes the widget to changes on that data.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Initializing </span><span class="si">#{</span><span class="nx">widget_data</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> widget in DataSource&quot;</span>

            <span class="nx">@increaseReferenceCountsForChannelsOfNewWidget</span><span class="p">(</span><span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Only bind widget to data of channels it has subscribed to</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">reference</span><span class="p">,</span> <span class="nx">translated</span> <span class="k">of</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">subscribed_channels</span>
                <span class="nv">channel_key = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">translated</span><span class="p">)</span>
                <span class="k">unless</span> <span class="nx">@reference_data</span><span class="p">[</span><span class="nx">channel_key</span><span class="p">]</span><span class="o">?</span>
                    <span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t bind widget to channel </span><span class="si">#{</span><span class="nx">channel_key</span><span class="si">}</span><span class="s"> &quot;</span> <span class="o">+</span>
                                <span class="s">&quot;because it was already removed&quot;</span><span class="p">)</span>
                    <span class="k">continue</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Subscribe the widget to the events of the channel</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">@_bindWidgetToChannel</span><span class="p">(</span><span class="nx">reference</span><span class="p">,</span> <span class="nx">translated</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">)</span>

        <span class="nv">_getWidgetMethod: </span><span class="nf">(fake_channel, widget) -&gt;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Gets the appropriate function from the widget to be called
whenever events on channel occur.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>channel: the channel on which events occur
widget: a widget instance
Returns: an actual function from the widget instance</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Get the channel key. This is where the actual data is in @data</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">channel_key = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">getChannelKey</span><span class="p">(</span><span class="nx">fake_channel</span><span class="p">)</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Get the method name</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nv">method_name = </span><span class="nx">channels_utils</span><span class="p">.</span><span class="nx">widgetMethodForChannel</span><span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">channel_key</span><span class="p">)</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Wrap callback in order to make sure that the we're always calling
the current method for a given key on the widget, since members
of a class instance can be overridden dynamically at any point in
JavaScript</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">widget</span><span class="p">[</span><span class="nx">method_name</span><span class="p">])</span>
                <span class="k">return</span> <span class="nf">-&gt;</span> <span class="nx">widget</span><span class="p">[</span><span class="nx">method_name</span><span class="p">](</span><span class="nx">arguments</span><span class="p">...)</span>
            <span class="kc">null</span>

        <span class="nv">_bindWidgetToRelationalChannel: </span><span class="nf">(fake_channel, channel, widget_data) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Given a widget, bind it to the events of a backbone collection
or of an individual item of the collection.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Determine the method to be called on the widget</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">[</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">events</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="nv">collection = </span><span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">collection</span>
            <span class="nv">widget_method = </span><span class="nx">@_getWidgetMethod</span><span class="p">(</span><span class="nx">fake_channel</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">widget_method</span>
                <span class="k">return</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Whole collection and also give the widget context</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">item</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span>
                <span class="nx">@data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">on</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">widget_method</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>If data is already there, just pretend it arrived just now.
but only if a fetch from server is not in progress
otherwise a unwanted list refresh will be triggered</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">last_fetch</span><span class="o">?</span> <span class="o">and</span>
                <span class="p">(</span><span class="o">not</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">waiting_fetches</span><span class="o">?</span> <span class="o">or</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">waiting_fetches</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="nx">widget_method</span><span class="p">(</span><span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">[</span><span class="nx">collection</span><span class="p">])</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Individual collection models</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">else</span>
                <span class="nv">individual_model = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>If model is already there, we just bind it and get over with it</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">if</span> <span class="nx">individual_model</span>
                    <span class="nx">individual_model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">widget_method</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span>
                    <span class="nx">widget_method</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">individual_model</span><span class="p">)</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Else, enqueue the (individual model ID, widget) pair and keep
checking for new items whenever data arrives into this channel.
When the model finally arrives, drop the reference to the widget.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="k">else</span>
                    <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="s">&#39;delayed_single_items&#39;</span> <span class="k">of</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">])</span>
                        <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">][</span><span class="s">&#39;delayed_single_items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">][</span><span class="s">&#39;delayed_single_items&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span>
                        <span class="nv">fake_channel: </span><span class="nx">fake_channel</span>
                        <span class="nv">channel: </span><span class="nx">channel</span>
                        <span class="nv">widget_data: </span><span class="nx">widget_data</span>
                        <span class="nv">id: </span><span class="nx">item</span>
                    <span class="p">)</span>

        <span class="nv">_bindWidgetToApiChannel: </span><span class="nf">(fake_channel, channel, widget_data) -&gt;</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Given a widget, bind it to the events of an api (raw data) channel.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">[</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">events</span><span class="p">]</span> <span class="o">=</span> <span class="nx">channels_utils</span><span class="p">.</span><span class="nx">splitChannel</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="nv">collection = </span><span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">collection</span>
            <span class="nv">widget_method = </span><span class="nx">@_getWidgetMethod</span><span class="p">(</span><span class="nx">fake_channel</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">widget_method</span>
                <span class="k">return</span>

            <span class="nv">raw_channel = </span><span class="nx">@data</span><span class="p">[</span><span class="nx">collection</span><span class="p">]</span>
            <span class="nx">raw_channel</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">widget_method</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">.</span><span class="nx">widget</span><span class="p">)</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>If data is already there, just pretend it arrived just now.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">@meta_data</span><span class="p">[</span><span class="nx">collection</span><span class="p">].</span><span class="nx">last_fetch</span>
                <span class="nx">widget_method</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@data</span><span class="p">[</span><span class="nx">collection</span><span class="p">])</span>

        <span class="nv">_bindWidgetToChannel: </span><span class="nf">(fake_channel, channel, widget_data) -&gt;</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Bind a widget to a given channel's events.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>This is the <strong>only</strong> place in which the datalayer should use
the widget reference. The reason for which we need the reference
here is that it subscribes it to the events of the private data
of the datasource.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>This will actually delegate to more specific types of bindings:
- bindings of widgets to backbone collections
(for relational channels)
- bindings of widgets to raw data
(for api channels)</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;Linking widget </span><span class="si">#{</span><span class="nx">widget_data</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> to </span><span class="si">#{</span><span class="nx">channel</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nv">resource_type = </span><span class="nx">@_getType</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">resource_type</span> <span class="o">==</span> <span class="s">&#39;relational&#39;</span>
                <span class="nx">@_bindWidgetToRelationalChannel</span><span class="p">(</span><span class="nx">fake_channel</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">resource_type</span> <span class="o">==</span> <span class="s">&#39;api&#39;</span>
                <span class="nx">@_bindWidgetToApiChannel</span><span class="p">(</span><span class="nx">fake_channel</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">widget_data</span><span class="p">)</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 05 2013 15:56:38 GMT+0300 (EEST)  </div></div></body></html>